************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
*                                    CHANGE_LOG_4.2.12                                                                 *
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************


*******************
ANOMALIES


------------
Acquisitions
------------

#33171 : Liste des suggestions
Correction du filtre sur les sources des suggestions pour l'impression PDF et correction du mimetype pour l'export tableau.

--------------
Administration
--------------

#34525 : Correction import sections
Correction de la requete de mapping localisation/section en import de section.

#33265 : Messages d'erreur de conversion
Correction de l'affichage des messages pour les installations en utf-8.

#33347 : Statistiques OPAC sur l'impression du panier
Correction de l'enregistrement de la statistique pour distinguer l'ouverture des options d'impression, de l'impression proprement dite. Changement du libellé pour les options d'impression.

#34098 : Connecteur Arte VOD
Mis à jour du connecteur Arte VOD

#35076 : Modification / Amélioration des scripts d'échange Ascodocpsy
Modification de la gestion du dédoublonnage des articles et des textes officiels

#35530 : Connecteurs OAI et nettoyage HTML
Correction du nettoyage HTML des notices importées en entrepot OAI.

#36470 : Création de recherche prédéfinie OPAC
Suppression du bouton "Rechercher" du formulaire n'ayant pas lieu d'être.

#36557 : Description des tables
Protection du nom de la base de données pour éviter les erreurs de requête lorsque celle-ci contient un caractère incorrect pour mysql.

#36700 : Indexation de la Faq
Correction de la clé primaire de la table faq_questions_words_global_index.

#37748 : Export XML MARC
Correction d'erreurs d'encodage des champs pour les PMB installés en ISO-8859-1

#37957 : Connecteur Zotero
Prise en compte des caractères spéciaux des notices zotero lors de la synchronisation du connecteur.

#38641 : Réindexation des données
Correction du vidage des tables d'index dans l'enchainement des réindexations.
---------
Catalogue
---------

#33517 : Remplacer par une source externe
Correction du critère ISBN pré-rempli lors du remplacement d'une notice par une source externe.

#33728 : Accès rapide aux paniers
Correction de l'affichage de l'accès rapide aux paniers pour les exemplaires. Ajout de l'accès rapide sur une recherche d'exemplaire. Ajout de l'accès rapide sur l'affichage des bulletins.

#35351 : Remplacement de notice par Z3950
Correction de la vérification de l'existence des fonctions de l'import modèle avant d'appeler celles-ci.

#35736 : Edition de panier d'exemplaire
Correction de l'export des champs personnalisés d'exemplaires dans les éditions tableur.

#35927 : Grille de notice
Correction du chargement d'une grille personnalisée après suppression d'un champ personnalisé de notice.

#36811 : Recherche booléenne sur les catégories
Correction de la recherche booléenne sur la page auteur/titre.

#38024 : Serveurs Z3950 au format Marc21
Correction de l'encodage des notices provenant de serveur Z3950 exportant au format Marc21

-----------
Circulation
-----------
#33430 : Liste des prêts dans un mailing emprunteur
Correction de la récupération des titres de série.

#33758 : Prolongation de prêt et date d'adhésion
Prise en compte du paramètre général pret_date_retour_adhesion_depassee pour les prolongations de prêt en gestion et à l'opac.

#34148 : Suppression de réservation
Lorsqu'un document est en transfert suite à une réservation mais que la réservation est supprimée par une autre localisation, faire en sorte que l'alerte "Document à traiter" apparaisse dans la bonne localisation.

#35298 : Calcul du niveau de relance
Correction du calcul du niveau de relance si le paramètre général utiliser_calendrier est valorisé à 2.

#38369 : Calcul du forçage des quotas
Correction du calcul quand l'action se fait sur une notice (par exemple, les réservations) mais que la recherche a été effectuée sur un exemplaire.
------
Divers
------

#35908 : Classement des infopages, paniers et étagères.
Correction de la redirection après modification d'un classement par le menu déroulant.

#37975 : Webservice bibloto
Correction de l'encodage du commentaire non-bloquant pour le prêt autonome.

#38235 : Web Services - Corrections des fonctions pmbesSearch_getAdvancedSearchFields et pmbesSearch_getAdvancedSearchField
Ajout des values et fieldvars pour les champs personnalisés qui n'étaient pas retournés auparavant par les fonctions pmbEsSearch_getAdvancedSearchFields et pmbEsSearch_getAdvancedSearchField.
Correction sur les champs retournés en fonction du royaume (opac) ou non.

#38668 : Webservice bibloto
Un message d'erreur affichait également une requête mysql. Celle-ci n'est désormais plus visible.

---
DSI
---

#33709 : Affichage des descripteurs en diffusion de DSI
Prise en compte du paramètre OPAC categories_show_only_last pour l'affichage des descripteurs.

#33921 : Mise à jour des veilles
Correction d'une erreur javascript sur l'appel de la mise à jour de la veille affichée.

--------
Editions
--------

#34155 : Liste des prêts d'un groupe
Correction du destinataire sur l'envoi de la liste des prêts d'un groupe depuis les éditions.

#35283 : Etats personnalisables
Correction de la prise en compte des apostrophes dans les paramètres de la requête, en changement de page sur la liste des résultats.

#37736 : Export tableur
Prise en compte de certains caractères spéciaux pour les PMB installés en ISO-8859-1.

#38562 : Fonction de template de notice #p_perso();
Description complétée des options de la fonction dans la documentation.

----
OPAC
----

#33215 : Répertoire temporaire pour l'impression PDF
Déplacement des fichiers de cache de la classe mpdf dans le répertoire /temp de PMB.

#33434 : Affichage des catégories proposées en recherche multicritères de catégorie avec autopostage
Correction de la prise en compte du paramètre opac categories_show_only_last.

#33598 : Bandeau d'avertissement des cookies
Correction de l'affichage du lien "En savoir plus" qui réagit différemment selon la version du navigateur.

#33707 : Indication de panier plein
Correction de l'affichage lors de l'ajout d'un lot de notices dans un panier

#33869 : Affichage des suggestions
Ajout d'une balise span sur le titre, lorsqu'aucune suggestion n'est présente.

#33939 : Impression de panier
Sans template, les notices sont séparées par une balise <hr />, avec template les notices sont séparées par une balise <br />.

#34027 : Fonction complémentaire inra pour les recherches en page d'accueil
Ajout d'une méthode manquante créant un blocage de la page.

#34259 : Ajout des dépouillements d'un bulletin dans un panier
Correction du lien dans le template Django pour les bulletins sans notice de bulletin.

#34357 : Résultat dans les recherches affiliées
Correction de la navigation dans les pages d'un résultat de recherche multi-critères.

#35346 : Correction de la possibilité de s'authentifier avec un mot de passe vide en OPAC
Par défaut, les mots de passe vides ne sont pas autorisés.
Vérification du mot de passe chiffré stocké pour le lecteur par rapport à un mot de passe vide chiffré pour ce même lecteur.

#35573 : Navigateur de sections
Correction du passage de paramêtre des liens de retour s'il est défini.

#36125 : Recherche par mots-clés
Correction de l'affichage des résultats si les recherches externes sont activées.

#37024 : Interrogation sur les sources externes
Correction du formulaire de recherche en interrogation des sources externes depuis un résultat de recherche multi-critères, correction de l'affichage du nombre de pages de résultat, correction de la mise en panier.

#38012 : Classe d'affichage personnalisée Livrechange
Correction de la fonction d'affichage personnalisée des exemplaires.

#38212 : Affichage du nom de la bannette
Affichage du nom de la bannette où l'on se trouve. Amélioration du message dans le cas ou une bannette n'avait pas de nouvelles informations à montrer.

-------
Portail
-------

#34044 : Filtre sur liste d'articles
Correction du filtre sur les champs génériques d'un article, dans le module liste d'articles.

#34053 : Filtres listes de rubriques
Correction des filtres sur les listes de rubriques.

#36347 : Correction verrouillage sur table de cache du Portail
Suppression du verrouillage de la table cms_cache_cadre lors de l'accès en Gestion.

#36692 : Amelioration de la gestion des images
Suppression de la transformation systématique en png.
Gère les images de type jpeg,png,gif

#36855 : Fonction de template Django limitstring
Prise en compte des entités HTML dans la troncature.

#37143 : Mise en cache des images du portail
Correction de la gestion de la transparence pour les images en PNG.


*******************
EVOLUTIONS


------------
Acquisitions
------------

#34045 : Export tableau des suggestions
Ajout de l'ISBN dans les champs exportés.

#36984 : Sécurisation du paramètre custom_calc_numero
Ajout d'un test pour s'assurer que le fichier appelé dans le paramètre custom_calc_numero existe.

#38005 : Envoi par email d'un devis à un fournisseur
Indication sur la page en cours si l'envoi a réussi ou échoué, comme pour les commandes.

--------------
Administration
--------------

#33212 : Log d'une sauvegarde
Ajout de la taille du fichier de sauvegarde dans le log généré.

#33335 : Fichier d'indexation des champs de la notice
Prise en compte d'un éventuel attribut "alias" sur le tag "idkey" du fichier d'indexation pmb/includes/indexation/notices/champ_base.xml

#33516 : Vérificateur de liens
Ajout de la possibilité de vérifier les champs personnalisés de type URL/Résolveur dans les états des collections des notices de périodique.

#36121 : Fonction de template de mail
Ajout d'une fonction permettant d'afficher la date du jour.

#36825 : Export RIS Zotero
Ajout d'un export spécifique à Zotero : ajout de la langue de publication et export en utf-8

#37247 : Modification / Amélioration des scripts d'échange Ascodocpsy
Modification de la gestion du dédoublonnage des articles et des textes officiels afin de prendre en compte la date complète.

#38490 : Export RIS Zotero
Les dépouillements sont exportés en articles de revue, plutôt qu'articles de magazines.

---------
Autorités
---------

#33793 : Impression d'un thésaurus
Ajout d'une option d'impression pour ne pas imprimer les traductions.

---------
Catalogue
---------

#35264 : Impression des étiquettes de cotes
Les cotes sont maintenant triées par ordre alphabétique.

-----------
Circulation
-----------

#33078 : Gestion du retour en fonction de la localisation de l'exemplaire
Ajout d'un paramètre général utiliser_calendrier_location basant le calcul du retard, de l'amende et du blocage sur la localisation de l'exemplaire, si le paramètre général utiliser_calendrier est à 1 et que l'exemplaire n'est pas rendu sur son site d'origine.

------
Divers
------

#33223 : Optimisation Webdav
Accélération du webdav de manière générale : 
- On évite de récupérer les notices inutiles
- On évite la double indexation à la création de notice

#33473 : Optimisation classes analyse_query
Modification de jointures entre tables pour une meilleure efficacité de la classe en gestion et en OPAC.

#34422 : Stockage d'un document numérique
Nettoyage des diacritiques et des caractères spéciaux des noms de fichier avant de les stocker dans les répertoires d'upload. Correction du dézippage des archives en cas de diacritique dans les fichiers.

--------
Editions
--------

#33732 : Variables des templates de bannette
Ajout des variables "Date de diffusion" et "Equation" dans les templates de bannette.

#36458 : Template de notice et fonction #strip_tags();
Ajout d'une fonction de template de notice pour supprimer les balises html d'une chaîne de caractères.

#37775 : Etat des circulations
Ajout d'un filtre sur la date de fin d'abonnement

#38194 : Exports tableur et fichiers temporaires
A chaque génération de fichier tableur, suppression des fichiers temporaires d'export tableur âgés de plus d'une heure.

----
OPAC
----

#31385 : Traduction des libellés des champs perso
Ajout de la traduction des libellés des champs perso en Opac.
Le bouton 'Traduction' déplie un formulaire de traduction en administration des champs perso 
La liste des langues est définie dans le paramètre thesaurus_liste_trad (fr_FR,en_UK,es_ES...)

#33068 : Durée de session des emprunteurs non connectés
La durée de session se base sur le paramètre OPAC duration_session_auth. Quand la session expire, une alerte l'indique et les informations de navigation sont ré-initialisées.

#33069 : Fonction django substr et substring
Ajout de
substr : retourne le reste de $string à la position $start 
substring : retourne le reste de $string après la premiere occurence de $needle

#33405 : Traduction des libellés des champs perso
Traduction en recherche multicritère des libellés des champs personnalisés.

#33547 : Ajout du lien vers le panier après y avoir ajouté une notice
Après avoir ajouté une notice au panier, le clic sur l'icône panier de la notice envoie vers le contenu du panier.

#33577 : Modification de la copie du lien court de recherche OPAC
Ajout de la copie directe dans le presse papier.

#33759 : Optimisation sql pour la visionneuse
Optimisation sql pour afficher le lien de la visionneuse en résultat de recherche

#36443 : Fonction django pour SSO Toutapprendre
Ajout d'une fonction django qui permet de récupérer les paramètres à passer dans l'URL pour le SSO avec Toutapprendre.
{{ connectors.toutapprendre.token }}

#36731 : Connecteur Cairn.info : SSO sur tous les liens provenant de http://www.cairn.info
Ajout du SSO sur tous les liens de notice provenant de http://www.cairn.info pour ne plus limiter seulement aux notices issues du connecteur Cairn.info.

-------
Portail
-------

#33427 : Ajout d'un lookup dans les templates django
Il est maintenant possible d'utiliser les expressions "{{ article.idarticle.proprietearticle }}" , "{{ section.idsection.proprietesection }}" .

#34065 : Prise en compte d'un argument "nofill" dans le module de recherche 
Si le paramètre nofill=1 est passée dans l'URL, le champ de recherche du module de recherche du portail n'est pas repris


*******************
DEVELOPPEMENTS

-------
Portail
-------

#33247 : EM Premium : Génération d'un accès SSO par lien
Possibilité d'ajouter dans les templates Django un lien d'authentification SSO sur le service EM Premium.
Il suffit d'ajouter cette portion dans un template :
<pre>{{ 'http://www.em-consulte.com/authliensecurise' | empremium 'identifiant_de_la_société' 'clé_privée' }}</pre>
Pour l'authentification, le code membre utilisé est le login du lecteur connecté.




************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
*                                    CHANGE_LOG_4.2.11                                                                 *
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************


*******************
ANOMALIES


------------
Acquisitions
------------

#32910 : Filtre sur les réceptions
Suppression de l'option devis dans les filtres des réceptions.

--------------
Administration
--------------

#30349 : Consolidation des statistiques opac
Correction du traitement des filtres des colonnes, provoquant une erreur fatale.

#30835 : Paramètre de type date dans le planificateur de taches
Correction de l'affichage de la valeur du paramètre de type date en cas d'exécution d'une procédure.

#31461 : Nettoyage des tables de cache pour les web-services
Ajout d'un index et changement de la méthode de nettoyage pour la table es_searchcache.

#31526 : Facette sur un champ personnalisé
Correction de l'enregistrement de la facette s'il n'existe qu'un seul champ personnalisé de notices.

#31893 : Classe JSON-RPC client
Correction de l'encodage des requêtes pour les installations de PMB en iso-8859-1

#31943 : Connecteur zotero et url
Prise en compte des caractères spéciaux dans le champ url de zotero lors de la synchronisation du connecteur.

#32360 : Droits d'accès utilisateur en import de notices
Correction du calcul des droits d'accès via l'import en administration.

#32514 : Réindexation des champs de recherche
Ajout des titres uniformes dans la liste des autorités réindexées.

#32559 : Connecteur sortant SOAP
Correction de l'encodage déclaré alors que les données sont renvoyées en utf-8.

---------
Catalogue
---------

#30312 : Prévisualisation de l'affichage opac d'une notice
Correction de l'encodage sur l'affichage de la notice via l'icone loupe.

#30552 : Encodage du nom de fichier en ajout de document numérique
Correction de l'encodage du message javascript s'affichant si un autre document existe déjà avec le même nom de fichier.

#30568 : Indexation des informations de type liste MARC
Prise en compte des listes dans l'indexation de la notice pour la recherche tous champs.

#30654 : Vérification du répertoire d'upload d'un document numérique
Ne pas tester la vérification du répertoire d'upload si le document numérique est une url.

#32022 : Affichage ISBD d'une notice de périodique
Prise en compte des retours à la ligne dans les champs personnalisés multi-lignes.

#32169 : Affichage ISBD d'une notice monographique en gestion
Passage du libellé "ISBN" en message afin de permettre sa personnalisation.

#32172 : Date de mise à jour d'un exemplaire
Comme pour les notices, modification de la date de mise à jour lorsqu'on clique sur enregistrer, même si aucun champ n'a été modifié.

-----------
Circulation
-----------

#32087 : Affichage des champs personnalisés d'emprunteur dans la fiche de circulation
Correction de l'affichage en cas d'accent.

#32952 : Transferts, retour sur le site d'origine
Correction de la mécanique permettant le retour sur le site d'origine quand le transfert est généré depuis une réservation et que la configuration indique un envoi direct sur le type de transfert généré.

------
Divers
------

#30620 : Scripts d'export Ascodocpsy
Ajout du complément de titre à l'export dans le champ TIT
Ne pas exporter les fonctions d'auteurs.

#31116 : Notice convertie par webservice
Correction de la gestion de l'encodage de la notice en fonction du paramétrage de PMB.

#32555 : Exports tableur et nom de fichier
Transformation de "xls" vers "xlsx" de l'extension des fichiers générés afin d'assurer une meilleure compatibilité avec les différents tableurs.

---
DSI
---

#30203 : Séparateur vertical de contenu dans les sources des veilles
Correction de la difficulté à déplacer ce curseur quand l'onglet "Sources" est cliqué.

#30745 : Flux rss 2.0 contenant un nom d'espace media
Nettoyage des items du flux pour éviter la perte du titre des items.

#30940 : Recherche de bannette
Modification des recherches de bannette : la bannette doit contenir la valeur cherchée, plutôt que commencer par celle-ci.

#32200 : Items de veille depuis le contenu éditorial et affichage du flux rss d'une veille
Correction de la récupération de la date de publication pour le contenu éditorial, ajout d'une entête xml pour un meilleur rendu dans les navigateurs.

--------
Editions
--------

#30132 : Tri des statistiques OPAC
En partie administration, les vues sont classées par consolidation décroissante, puis par nom. Au sein de chaque vue, les requêtes sont classées par nom.
En partie éditions, les vues sont classées par nom. Au sein de chaque vue, les requêtes sont classées par nom.

#31093 : Export excel des états personnalisables
Les cellules correspondant au résultats de la requête sont exportées sans précision de format.

#31823 : Template de notice et fonction #initiale();
Prise en compte des majuscules accentuées (encodées sur deux caractères) pour retourner le premier caractère du mot.

#32066 : Fonction de template de notice #vignette();
Encodage des caractères spéciaux dans l'url de la vignette si nécessaire.

#32708 : Edition des prêts courts
Correction des titres de haut de page pour les prêts courts.

----
OPAC
----

#30079 : Impression pdf du type public du format par défaut.
Correction de la mise en page du tableau pouvant déborder de la page.

#30250 : Lien vers la visionneuse
Sur les notices de périodiques, l'affichage du lien vers la visionneuse des documents numériques des bulletins associés tient compte des droits de visibilité de ces documents.

#30325 : Télécharger les documents numériques du panier
Si le panier ne contient aucun élément téléchargeable, ajout d'un message d'alerte et fermeture de la fenêtre.

#30366 : Affichage du choix vide sur les champs personnalisés de type liste
En recherche multi-critères OPAC, on cache le choix vide si celui-ci ne possède pas de valeur enregistrable.

#30483 : Création d'une nouvelle demande
Correction sur le calcul des droits d'accès de la notice rattachée à une demande.

#30896 : Modification titre uniforme template django common de notice
Modification de l'affichage des titres uniformes dans l'affichage détaillé.

#30931 : Affichage des résultats d'un lien permanent de recherche
Correction de l'application des facettes sur le résultat quand l'autolevel2 n'est pas paramêtré à 2.

#30955 : Modification du template de notice common en affichage réduit
Ajout du strip_tags pour enlever le HTML sur le résumé tronqué en affichage réduit.

#31026 : Prolongation depuis le compte lecteur
Correction du message affiché lorsque la prolongation n'est pas encore disponible.

#31120 : Thésaurus par défaut en recherche par terme
Possibilité de sélectionner "Tous" par défaut si le paramètre OPAC thesaurus_defaut est valorisé à 0.

#31162 : Affichage d'une notice
Correction d'une erreur si aucun champ personnalisé n'est présent sur les notices.

#31169 : Enrichissement des notices et onglets personnalisés
Correction de l'affichage des enrichissements des notices et des onglets personnalisés dans les templates Django.

#31209 : Enrichissement Wikipedia
Correction de l'encodage de l'enrichissement pour les PMB en utf-8 qui provoquait le non-chargement de l'enrichissement.

#31270 : Correction injection SQL lors de la recherche par tag
Correction injection SQL lors de la recherche par tag

#31509 : FullScreen Visionneuse
Correction d'un problème de redimensionnement lors du passage de l'affichage "Plein écran" à l'affichage "Normal".

#31654 : Affichage des facettes
Correction sur l'encodage de certains caractères.

#31733 : Critère "Nouveautés" de la recherche multi-critères
Déplacement du critère de la partie "Périodiques" vers la partie "Champs principaux".

#31813 : Date de création affichée en flux rss
Correction de l'affichage de la date.

#31845 : Ajout de style sur l'auto-complétion
Amélioration du style dans la common pour l'auto-complétion. Dorénavant, il y a un curseur au survol d'un élément de la liste, et la couleur de fond change.

#31957 : Recherche prédéfinie OPAC non restreinte aux champs définis
Modification du comportement si l'on supprime tous les champs pour en ajouter d'autres à l'OPAC, les champs d'origine ne sont pas repris automatiquement.

#32211 : Recherche multicritère et retour page précédente
En recherche multicritère les champs d'autorité se ré-affichent correctement sur un retour au formulaire de recherche via l'historique du navigateur.
Les champs input avec l'attribut 'autocomplete' à 'off' ne sont pas forcement bien restitués par tous les navigateurs 

#32329 : Réservation par panier
Correction de l'affichage des réservations sur un lot de notices cochées dans le panier

#32484 : Liens vers les catégories dans le fil d'ariane
Correction du lien, on ne passe un paramètre main que s'il est valorisé.

#32512 : Cache des vignettes du portail
Correction du calcul de la date de mise en cache de la vignette.

#32635 : Modification des templates django common de notices
Dans l'affichage django common détaillé des bulletins sans notice, suppression de l'image et harmonisation du lien "lien vers la notice" avec les autres affichages.
Ajout du séparateur entre le numéro et le libellé de période du bulletin dans l'affichage django common réduit et détaillé des articles.

#32855 : Classe d'affichage personnalisée CTLES : Modification des états de collections à l'opac
Correction de l'enregistrement ne prenant pas en compte les retours à la ligne.

#32859 : Ajouter les documents en prêt au panier
Correction d'une erreur au moment de l'ajout des documents en prêt au panier.

-------
Portail
-------

#31074 : Page de connexion après une fin de session en édition de contenu éditorial
Après une fin de session en édition de contenu éditorial, une action (ajax) sur ce contenu propose la connexion.
Cette connexion redirige sur le contenu éditorial

#31099 : Correction test sur les conditions d'affichage
Dans certains cas, le test retournait un type de page "Recherche simple" plutôt que "Résultat de recherche"


*******************
EVOLUTIONS


------------
Acquisitions
------------

#32627 : Export tableur des suggestions
Ajout des colonnes prix et commentaire.

--------------
Administration
--------------

#30760 : Création d'un nouvel utilisateur
Le paramètre utilisateur "Proposer les catégories en remplacement de notice ?" est valorisé à oui en création d'utilisateur.

#31533 : Lien vers la documentation des fonctions de parse HTML
Lien ajouté dans le commentaire du paramètre OPAC "parse_html".

#31939 : Création d'un nouvel utilisateur
En création d'utilisateur, la langue sélectionnée par défaut est la même que celle de l'utilisateur courant.

#32471 : Nettoyage des mots de passe des lecteurs
Ajout d'une alerte sur la page de mise à jour de la base, et ajout d'une option dans le nettoyage de la base : après l'encodage réussi des mots de passe lecteurs, il faut nettoyer la table contenant les mots de passe non cryptés.

#32786 : Import de notices et d'exemplaires
Possibilité de choisir si les notices créées seront des nouveautés ou non.

---------
Catalogue
---------

#30993 : Mimetype des fichiers flv
Ajout des fichiers flv à la liste des mimetypes connus pour obtenir une icone sur ce type de fichier.

#31251 : Liste des paniers en accès rapide
Affichage d'une icone indiquant les paniers en accès rapide dans la liste des paniers.

#31537 : Ajout d'un champ commentaire de gestion pour les étagères
Ajout d'un champ commentaire de gestion pour les étagères

#31610 : Recherche par auteur
Si l'auteur possède une forme retenue, affichage du nombre de notices correspondant à cette forme retenue.

#31747 : Import de notice par Z3950
Lorsqu'aucune origine n'est définie dans la notice z3950, celle-ci se valorise avec le nom de la source.

#31926 : Taille des champs en recherche multi-critères
Augmentation de la taille des champs possédant une autocompletion ajax, pour une meilleure visibilité des valeurs proposées.

#32209 : Accès aux dernières notices
Création d'un raccourci clavier Esc + D pour un accès direct aux dernières notices.

#32717 : Vignette d'un document numérique
Possibilité de personnaliser la vignette d'un document numérique via l'url d'une image.

#32767 : Recherche de périodique
Ajout d'un filtre sur les abonnements actifs ainsi que d'une icone signalant ceux-ci.

#32906 : Création d'une suggestion depuis une notice existante
Reprise de l'année dans la date de parution.

-----------
Circulation
-----------

#30622 : Bloquer les prêts dès qu'un lecteur est en retard
Evolution des paramètres généraux blocage_delai et blocage_max permettant de bloquer les prêts dès qu'un lecteur est en retard et de les débloquer dès qu'il n'est plus en retard.

#32266 : Personnalisation des filtres des relances
Ajout d'un paramètre permettant d'ajouter des critères sur les filtres des relances

#32467 : Impression de la liste des prêts
Augmentation du nombre de prêts affichés sur l'impression via le bouton "Imprimer" de la fiche lecteur

#32704 : Date de prolongation et calendrier d'ouverture
Si la date sélectionnée manuellement pour une prolongation ne correspond pas à une date d'ouverture, ajout d'un message permettant de conserver cette sélection ou de sélectionner le jour d'ouverture suivant.

#32739 : Lettres et mails de retard
Ajout d'un paramètre 'hide_fine' permettant de cacher les amendes et frais de relance.

#32885 : Affichage d'un groupe : envoi de mail
Ajout d'un bouton permettant d'envoyer la liste des prêts du groupe par email au responsable, si celui-ci possède un email.

#32916 : Deuxième niveau de relance
Création d'un paramètre 'priorite_email_2' permettant de forcer l'envoi de la deuxième relance par lettre, si le paramètre 'priorite_email' est à 1.

--------
Demandes
--------

#31252 : Accès à la FAQ
Ajout d'un lien direct vers la FAQ de l'OPAC sous le tableau des questions de la FAQ.

------
Divers
------

#30177 : Style de l'autocompletion ajax
Passage du style de l'autocompletion en classes css pour permettre de les personnaliser, en gestion et en OPAC.

#30828 : Exports tableur
Optimisation sur la classe d'export tableur permettant d'éviter des dépassement de mémoire sur le serveur.

#31258 : Statistiques OPAC et modèles prévisionnels
Affichage d'un lien vers les fonctions disponibles

---
DSI
---

#31247 : Création d'un article ou d'une rubrique depuis un item de veille
Récupération du logo s'il existe et ajout du lien dans le résumé.

#31949 : Nombre de bannettes publiques affichées
Possibilité de choisir le nombre de bannettes publiques affichées en liste de bannettes.

--------
Editions
--------

#31123 : Templates de notice
Ajout d'un lien vers la documentation sous la liste des templates disponibles

#31595 : Templates de bannettes : fonction pour la connexion automatique à l'OPAC
Modification de la fonction de connexion automatique afin qu'elle affiche du html modifiable. Ajout de la fonction de connexion et d'accès automatique à la gestion des alertes.

----
OPAC
----

#30681 : Ajout d'attribut class dans la faq
Lorsqu'une question est dépliée dans la faq, ajout d'une classe spécifique.

#30703 : Recherche simple sur les catégories
Ajout d'une classe spécifique pour les renvois voir.

#30790 : Affichage des facettes
Possibilité de replier les facettes

#30799 : Recherche sur les champs personnalisés des exemplaires
Ajout des critères de recherche sur les champs personnalisés d'exemplaires lorqu'ils sont visibles à l'OPAC.

#31023 : Visionneuse audio
Lecture de la visionneuse audio avec la balise html5 audio afin d'assurer une meilleure compatibilité avec les navigateurs.

#31098 : Toolkits : Cache navigateur pages CSS
Prise en compte de la modification des feuilles de style (intégrées aux toolkits "uikit", "jquery", etc..) en cas de contenu modifié par rapport au contenu stocké par le navigateur.

#31385 : Traduction des libellés des champs perso
Ajout de la traduction des libellés des champs perso en Opac.
Le bouton 'Traduction' déplie un formulaire de traduction en administration des champs perso 
La liste des langues est définie dans le paramètre thesaurus_liste_trad (fr_FR,en_UK,es_ES...)

#31602 : Notices de périodique et affichage django
Ajout de la fonction permettant d'afficher :
- le lien vers les bulletins disponibles
- le lien vers les documents numériques associés aux bulletins
- le lien vers la recherche dans le périodique

#31642 : Ajout de fonctionnalités dans les affichages common django
Ajout de fonctionnalités dans l'affichage common django détaillé des périodiques. Liens :
- "Voir les bulletins disponibles"
- "Voir les documents numériques associés aux bulletins"
- "Rechercher dans ce périodique"

#31664 : Refonte des templates common django de notices
Refonte des templates d'affichage common django réduit et détaillé des notices de bulletins et d'articles pour optimisation.

#31691 : Pagination des bulletins
Dans l'affichage détaillé d'un périodique en OPAC, ajout d'une ancre pour que la page se replace au même endroit lors de la navigation dans les bulletins.

#31710 : Création d'un template django de notice "common_bretagne"
Création d'un nouveau template django de notices "common_bretagne" étendu du template "common", avec le tableau des exemplaires accessible depuis l'affichage en résultat de recherche.

#32004 : Amélioration de la visionneuse Bookreader
- Affichage du nombre total de page au survol dans le paginateur
- Ajout d'un nouveau contrôle dans la barre à outils:
   - On peut modifier le contraste des images à la volée
   - On peut modifier la luminosité des images à la volée

#32034 : Affichage des prêts à l'OPAC
Pour une meilleure lisibilité du tableau, la colonne des retards passe en dernière position.

#32159 : Traduction des champs perso de tri
Affichage du titre traduit du champ perso de tri de recherche en Opac

#32196 : Optimisation du portail
Amélioration de la gestion du cache du portail pour plus de rapidité

#32256 : Critères d'une alerte à l'opac
Sur l'affichage du contenu d'une alerte, possibilité d'afficher les critères de recherche de l'alerte

#32448 : Impression PDF à l'OPAC
Utilisation d'une nouvelle classe externe pour gérer les impressions PDF.

#32497 : Ajout d'une infobulle sur Bookreader
Ajout d'une infobulle sur le bouton de réglage du contraste sur la visionneuse Boookreader

#32500 : Ajout de balise META sur les pages du panier
Ajout de la balise "<meta name="robots" content="noindex, nofollow">" pour ne pas que les robots indexent les pages du panier.

#32720 : Mise en cache fichiers des fichiers XML de langue de la visionneuse
Gestion d'un cache fichier sur les XML de la visionneuse pour s'affranchir du parse systématique

#32724 : Optimisation de la génération des images via la visionneuse  bookreader
Optimisation de la restitution des images via la visionneuse bookreader.
On évite d'aller chercher certaines infos non nécessaire.
Si on peut, au 2ème appel, on laisse le cache du navigateur faire le travail

#32771 : Ajout d'une patience au chargement de la visionneuse
Ajout d'un icône patience à l'ouverture de la visionneuse

-------
Portail
-------

#30261 : ZEN - Alignement de la date de l'événement dans le carrousel d'actualités en page d'accueil
La date de l'événement dans le carrousel d'actualités en page d'accueil est maintenant alignée à droite avec la charte 'zen_one'.

#30864 : Ajout d'un filtre selon un champ générique
Dans les modules liste d'articles et liste de rubriques, ajout d'un filtre selon un champ générique avec tous les types de contenu.

#32895 : Ajout d'un filtre sur le module liste d'items de veille
Création d'un filtre ne sortant que les items "intéressant" issus d'une veille.


*******************
DEVELOPPEMENTS


--------------
Administration
--------------

#30201 : Connecteurs SSO Cairn
Mise en place d'un système SSO entre CAIRN et PMB.
Création d'un connecteur OAI spécifique à CAIRN pour permettre une authentification automatique sur leur plateforme.
Nécessite de renseigner un identifiant d'institution fournit par CAIRN et nécessite de transmettre à CAIRN un identifiant généré par PMB.

------
Divers
------

#32331 : Export SKOS
Export SKOS disponible pour les catégories (état expérimental)

----
OPAC
----

#31255 : Visionneuse bookreader : Lecture d'images dans une archive ZIP
Implémentation de la lecture d'images d'une archive ZIP au sein de la visionneuse.




************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
*                                    CHANGE_LOG_4.2.10                                                                 *
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************


*******************
ANOMALIES

------------
Acquisitions
------------

#27175 : Liste personnalisée des suggestions
Correction du filtre par emprunteur dans l'affichage de la liste des suggestions personnalisée pour le genes et agroparistech.

--------------
Administration
--------------

#26121 : Modification / Amélioration des scripts d'échange Ascodocpsy
Correction du souci de conversion entre l'encodage Windows-1252 (Différent de l'iso-8859-1) et l'UTF-8

#26323 : Set de notices et notices liées
Correction de l'export des notices d'un entrepôt sortant selon la configuration de la génération des liens.

#27532 : Connecteur OAI sortant et dates
Correction du filtre sur les dates demandées pour un connecteur OAI sortant, lors de la génération du cache des notices.

#28251 : Format d'export XML MARC
Correction de l'encodage pour les installations en iso-8859-1

#28540 : Format OAI DC pour entrepôt OAI PMH
Suppression du champ unimarc 100$a de la feuille de conversion vers le format oai_dc.

#28923 : Récolteur de notices
Correction dans l'appel aux tris des facettes dans le récolteur de notices

#29818 : Autorités Origine
Correction de la création, modification et suppression d'une origine.

---------
Catalogue
---------

#25892 : Critère de recherche "Notice fille associée" en recherche multicritères de gestion
Correction de la requête générant la liste des liens utilisés.

#26214 : Import d'article ou de bulletin via Z39.50
Si la notice de périodique doit être créée, prise en compte du paramêtre utilisateur "Type de notice par défaut en création de périodique".

#26277 : Mots vides et index des notices
Prise en compte de la langue d'indexation pour la suppression des mots vides dans les index des notices.

#26292 : Prolongation d'abonnement
Correction du blocage javascript de la prolongation d'abonnement selon les dates des modèles prévisionnels.

#26534 : Sélecteur de dates dans le tableau des suggestions
Correction de l'affichage du sélecteur pour les personnalisations genes et agroparistech.

#26616 : Appel des catégories à la ré-indexation d'une notice
Correction de l'appel qui générait une réindexation en cascade des notices liées à cette catégorie.

#26635 : Date d'un bulletin en import Z39.50
Correction de l'enregistrement de la date d'un bulletin si l'on ne passe pas par le bouton "Calendrier" en import de notice par Z39.50.

#26758 : Documents numériques en base de données
Correction de la modification d'un document numérique en base de données pouvant entraîner sa suppression selon le paramétrage.

#26764 : Dates affichées d'un article
Correction des dates de création et modification de la notice affichées sur la modification d'un article.

#26766 : Prolongation d'abonnement
Correction de la prolongation regénérant le bulletinage depuis la date de début d'abonnement.

#26837 : Création d'une catégorie
Correction du bug bloquant la création d'une nouvelle catégorie.

#27107 : Saisie de l'éditeur d'un périodique
Correction du problème de fermeture du pop-up de sélection d'un éditeur dans une notice de périodique.

#27349 : Blocage du calcul du bulletinage
Dans le cas d'un paramétrage d'un modèle prévisionnel d'abonnement de périodique en mode cyclique mais avec une incrémentation à 0 (Jours, Mois ou Année) cela bloquait le chargement du bulletinage dans PMB.

#27481 : Import d'article ou de bulletin via Z39.50
Modification des critères de déboublonnage pour vérifier l'existence d'un bulletin dans la base.

#27492 : Encodage dans un connecteur entrant Webservices PMB
Lors d'import dans un PMB en iso à partir d'un connecteur entrant WebServices PMB vers un PMB en utf-8, certains caractères Windows-1252 n'étaient pas gérés correctement

#27650 : Fonction d'import Z3950 func_bretagne
Correction d'une erreur d'inclusion de fichier pour cette fonction d'import.

#27666 : Import d'article via Z39.50
Correction du calcul de la date de parution de l'article.

#27817 : Export de panier en gestion
Correction de la génération du nom du fichier pour éviter les caractères incorrects.

#27852 : Ré-indexation des notices
Lors de la ré-indexation de toutes les notices de la base, si l'une d'elle était indexée dans une autre langue que celle de l'utilisateur, alors les mots vides étaient mal gérés pour les suivantes.

#28027 : Droits d'accès et paniers
Correction de l'application des droits d'accès après une procédure panier

#28060 : Sélecteur d'autorité personnalisée
Correction de l'erreur javascript dans le sélecteur quand l'isbd de l'autorité contient un retour à la ligne.

#28086 : Recherche multicritères de champs personnalisés
Correction de la génération des requêtes lorsque plusieurs champs personnalisés sont recherchés

#28122 : Format de date de la langue de l'utilisateur
Respect du format de date selon la langue, dans l'audit et en édition de notices, pour les dates de création et de modification.

#28126 : Recherche multicritère d'exemplaires
Correction du critère "Est vide" sur les champs personnalisés de notices

#28564 : Dédoublonnage des notices
Suppression du critère de niveau bibliographique présent sur certaines requêtes, mais pas toutes. Ajout du niveau bibliographique dans les critères possibles du paramêtre "notice_controle_doublons".

#29120 : Eléments pointés ou non dans une édition de panier
Correction de la sélection du pointage pour l'édition d'un panier.

#29927 : Critère "n'est pas vide" en recherche multicritère d'exemplaires
Correction du libellé pour deux critères de recherche s'affichant vides.

-----------
Circulation
-----------

#26352 : Prêt d'exemplaire réservé
Correction du piège dans le cas du prêt d'un exemplaire réservé, sur une réservation qui n'est pas de rang 1.

#27558 : Recherche d'emprunteur avec filtre sur la localisation
Correction du filtre sur la localisation sur une recherche simple d'emprunteur

#27821 : Transfert vers sa propre localisation
Correction d'un cas de figure provoquant un transfert d'une localisation vers elle-même.

#27841 : Amende et numéro d'exemplaire
Correction de la reprise du numéro d'exemplaire dans le texte de l'amende.

#27873 : Groupe de lecteur
Correction de l'ajout du responsable au groupe en création de groupe de lecteur.

#27942 : Transferts, retour de prêt sur le site d'origine
Pour un transfert actif, le retour de prêt sur le site d'origine clôture correctement le transfert en cours.

#28104 : Recherche multicritères emprunteurs
Correction du critère de recherche sur la langue OPAC.

#28325 : Réservation non validée et prêt
Correction de la régression qui ne supprimait plus une réservation non validée quand on prêtait un exemplaire à un emprunteur ayant réservé.

#28664 : Génération automatique de code-barre emprunteur avec préfixe
Correction de la génération du code-barre dans le cas d'un préfixe et de codes-barres existants hétérogènes.

#28543 : Automate de prêt
Lors du prêt ou du retour d'un exemplaire lié à une notice avec un titre plus long que 200 caractères l'automate se déconnectait.

#28786 : Impression d'une liste de circulation
Pour l'impression ou la ré-impression d'une liste de circulation sur template manuel, si aucun champ n'a été défini, on prend le template PMB par défaut afin d'éviter l'impression d'une page blanche.

#28825 : Envoi direct d'un document sur son site d'origine (transfert)
Correction du message affiché lors d'un retour de prêt si le document nécessite un retour sur son site d'origine via un envoi direct.

#29047 : Transfert généré pour un retour à la localisation d'origine
Correction de la sélection de la localisation d'origine pour un exemplaire rendu sur un autre site qui n'est pas en transfert.

#29384 : Liste des langues OPAC de l'emprunteur
Correction de la génération de la liste sur la fiche emprunteur.

#29816 : Email de validation de réservation
Correction du message indiquant la date de la réservation.

------
Divers
------

#26029 : Style Zen : corrections de bugs graphiques
Corrections de bugs graphiques dans le style 'zen_one'.
Amélioration du responsive, de l'agenda et de l'affichage des boutons d'actions sur une notice.

#26094 : Affichage des actions rapides sur les paniers
Correction de l'anomalie bloquant l'affichage des actions rapides après la suppression d'un panier, en circulation et en catalogue.

#26412 : Style Zen : bouton 'partager résultat de recherche'
Mise en forme du bouton 'partager résultat de recherche' dans le style 'zen_one'.

#26413 : Style Zen : Mise en forme de l'article tronqué
L'article tronqué dans le portail reçoit maintenant la couleur des liens lors de son survol dans le style 'zen_one'.

#26466 : Style Zen : Correction du module de connexion
Correction du module de connexion non masqué en mode responsive dans le style 'zen_one'.

#26652 : Libellés dans le code source
Passage de libellés dans les fichiers de messages.

#27970 : WEBDAV : Correction de la gestion des droits d'accès sur les documents numériques
WEBDAV : Correction de la gestion des droits d'accès sur les documents numériques

#27972 : Encodage de la recherche dans les sélecteurs
Correction de l'encodage pour plusieurs sélecteurs, générant un mauvais affichage dans les navigateurs récents.

#28491 : Libellé des valeurs de case à cocher oui/non dans les human query
Prise en compte de la langue pour les libellés oui/non

#28640 : Scripts d'échange Ascodocpsy
Modification / Amélioration des scripts d'import et d'export pour les fichiers Ascodocpsy
Ajout de l'export Ascodocpsy à l'Opac

#29036 : Style Zen : Correction de l'ouverture du clavier virtuel
Correction de l'ouverture du clavier virtuel en mode responsive dans le style 'zen_one'.
Le clavier virtuel fonctionne maintenant correctement.

---
DSI
---

#26345 : Droits des utilisateurs sur les veilles
Correction de l'affichage des droits des utilisateurs après enregistrement d'une veille.

#27555 : Abonnement des lecteurs
Correction de l'abonnement des lecteurs à une bannette lorsque le filtre "Lecteurs ayant une adresse mail ?" est coché

#27927 : Diffusion de bannette et fichier joint
Correction de l'envoi du produit documentaire joint en cas de diffusion de bannette avec groupement par facette et template de bannette.

#28108 : Génération du document de la bannette
Correction de l'encodage du document généré.

#28623 : Diffusion de bannettes privées
- correction de la génération de l'envoi pour la première diffusion depuis l'OPAC, harmonisation avec la diffusion depuis la gestion
- correction de différents affichages des requêtes effectuées
- ajout d'un paramètre pour gérer le nombre de notices diffusées à la création d'une alerte privée.

#28667 : Édition de source dans les veilles
Correction du rafraîchissement automatique qui nous faisait perdre la saisie ou l'édition d'une source.

--------
Editions
--------

#26111 : Fonction de template de notice #expl_num_with_tpl();
Les documents numériques retournés sont dorénavant triés selon le paramètre OPAC explnum_order.

#27777 : Tableau des réservations en cours
Correction du tri sur entêtes cliquables.

#28481 : Ajout d'emprunteurs dans un panier
Correction de l'ajout des emprunteurs depuis l'alerte "Catégorie de lecteurs à changer"

#28618 : Éditions des caisses
Dans l'onglet Éditions > Caisses, les informations d'encaissement (Non validée, Validé, Non Encaissé) des abonnements, amendes et prêts sont bien recalculées.

#29854 : Impression des lettres de retard
Suppression de l'espace généré par les amendes s'il n'y en a pas dans l'impression de la lettre de retard.

----
OPAC
----

#25976 : Correction du calcul de la signature d'une recherche simple personnalisée
Correction pour la bonne prise en compte des recherches personnalisées dans le calcul de la signature d'une recherche simple.
La restitution d'un résultat mis en cache est désormais correct pour une recherche simple composée de valeurs multiples présentées sous forme de tableau PHP.

#26321 : Bulletinage d'un périodique
Correction du critère d'affichage des bulletins d'un périodique à l'OPAC.

#26533 : Correction de style dans la navigation par section
Suppression de la taille de cellule définie en dur, ajout d'une classe sur cette même cellule.

#26900 : Ajout de messages infobulles dans le template common
Dans les affichages djangos de notices 'common', ajout d'infobulles manquantes sur les boutons d'actions et harmonisation de leur affichage.

#27178 :  Affichage du libellé OPAC du statut de notice
Correction de l'affichage du libellé OPAC du statut de notice dans les affichages django.

#27451 : Affichage des onglets des notices liées
Correction de la génération des onglets depuis les templates de notice.

#27813 : Affichage des champs personnalisés en recherche multi-critères
Suppression de l'attribut colspan mal calculé sur les champs personnalisés

#27825 : Modification d'une liste de lecture
Correction de la fonction vérifiant l'unicité du nom de la liste de lecture.

#27904 : Visionneuse de documents numériques
Correction des différents droits d'accès aux documents numériques

#28056 : Infobulle sur impression du résultat de recherche
Déplacement de l'attibut title de l'image vers le lien encadrant celle-ci.

#28109 :  Prise en compte des templates de notice dans les affichages django des notices
Selon le parametre "notices_format_onglets" les templates de notice s'affichent dans les affichages django des notices

#28137 : Template common : ajout onglets d'enrichissement personnalisés
Prise en compte des onglets d'enrichissement personnalisés dans les affichages Djangos détaillés de notices 'common' et prise en compte de ces onglets dans la condition d'affichage de l'onglet "Détail".

#28179 : Modification template common de bulletin sans notice
Ajout du titre du bulletin pour le template django de bulletin sans notice

#28205 : Correction d'un problème de contexte depuis l'ajout du permalink de recherche
Depuis l'ajout de la fonctionnalité, il y avait un souci avec le contexte de la recherche qui impactait: la recherche en elle-même dans certains cas, les facettes, l'impression et la mise en panier

#28239 : Affichage des langues
Langues de publication et langues originales sont bien affichées dans les templates django de notice.

#28290 : Modification template django de notices common
Rectification des conditions d'affichages des séparateur dans les templates django de notices common

#28312 : Mise en panier et mots vides
Prise en compte des mots vides dans les requêtes générées pour la mise en panier.

#28389 : Affichage de la vignette d'une notice
Passage par getimage.php si le champ 'URL de la vignette' de la notice est renseigné.

#29363 : Page OPAC des catégories
Correction d'un lien mal fermé, ajout de classe sur l'image du dossier et ajout de balise div entre chaque catégorie.

#29934 : Plusieurs balises <h1> dans la page d'inscription
Correction de la double balise remplacées par des balises <h2> avec un attribut class.

-------
Portail
-------

#28416 : Indexation du contenu éditorial
Correction de l'indexation qui pouvait concaténer deux mots.

#27271 : Recherche exacte dans le contenu éditorial
Recherche exacte dans le contenu éditorial en utilisant les guillemets

#27332 :  Tri par arborescence dans les listes d'articles
Le tri prend en compte l'ordre de toute l'arborescence des rubriques parentes

#29949 : Collections numériques et caractères accentués
Correction de la perte des caractères accentués à la modification d'un document d'une collection numérique.

#30020 : Edition d'un article après une suppression d'article 
Dans le contenu éditorial, après suppression d'un article, l'édition d'un autre article redevient possible (erreur javascript)

#30048 : Champs résumé du contenu éditorial
Correction du problème d'affichage du contenu des résumés.


*******************
EVOLUTIONS

------------
Acquisitions
------------

#27171 : Commentaire de gestion d'une suggestion
Ajout du commentaire de gestion à l'index d'une suggestion pour pouvoir chercher sur ce champ.

#27889 : Recherche de commande et de facture
Ajout d'un sélecteur permettant de filtrer sur les exercices actifs.

--------------
Administration
--------------

#26201 : Synchronisation du connecteur entrant Zotero
Possibilité de personnaliser la feuille de transformation xslt appliquée sur les notices importées dans l'entrepôt.

#26354 : Répétitivité d'une tâche dans le planificateur
Description détaillée de l'exemple de répétitivité dans l'aide contextuelle d'une tâche.

#26476 : Modification / Amélioration des scripts d'échange Ascodocpsy
Changement de la gestion des états de collection
Simplification du formulaire d'import.

#26694 : Groupes dans le connecteur Zotero
Possibilité de synchroniser les groupes et les collections de groupes liés au compte via le connecteur Zotero.

#28115 : Modification / Amélioration des scripts d'échange Ascodocpsy
Changement de la gestion de l'emplacement des états de collection. (Import / Export)
Ne garder que les messages d'erreurs lors de la conversion
Modification de la date pour les articles de texte officiel

#28721 : Création d'une facette
S'il n'existe qu'un filtre secondaire à la création d'une facette, celui-ci n'est pas affiché mais sélectionné par défaut. Création d'une exception pour les champs personnalisés afin que le nom du champ s'affiche.

#28927 : Paramétrage des vues OPAC
Ajout de boutons "Tout cocher" et "Tout décocher" dans les différentes parties des filtres des éléments de l'Opac.

---------
Catalogue
---------

#27700 : Tri des notices en partie gestion
Possibilité de trier les notices par catégories

#29253 : Paramétrage de l'abonnement
Ajout du champ d'exemplaire prix dans le paramétrage de l'abonnement

-----------
Circulation
-----------

#26803 : Redirection sur prêt inconnu
Remise en place du script permettant d'accéder directement à un emprunteur en validant son code-barre dans la recherche d'exemplaire

#28905 : Profession de l'emprunteur
Ajout de l'autocomplétion sur le champ profession de la fiche emprunteur.

#29182 : Circulation des périodiques
Tri par défaut sur ordre décroissant de la date de parution, changement du libellé pour la colonne "Libellé de période" et tri alphabétique sur cette même colonne.

#29822 : Templates de mail
Ajout d'une variable permettant de n'afficher que les prêts en retard dans les templates de mail.

------
Divers
------

#26316 : Ajout d'index sur la table catégories
Ajout d'un index sur le champ num_thesaurus de la table, pour certaines actions personnalisables ne passant pas par la table noeuds.

#26598 : Style Zen : Optimisation de l'affichage du bouton aide dans le module de recherche rapide
L'affichage du bouton aide dans le module de recherche rapide a été revu afin d'être mieux intégré au module dans la feuille de style 'zen_one'.

#27014 : Correction style de gestion Enjoy
Amélioration de la lisibilité du tableau des exemplaires en gestion.

#27843 : Format d'export XML MARC
Ajout du format d'export XML MARC pour les échanges avec la plateforme EBSCO.

#28803 : Exports tableur
Ajout d'une nouvelle classe externe pour les exports tableur, permettant une meilleur compatibilité avec les tableurs récents.

---
DSI
---

#27565 : Templates de bannettes
Création d'une variable permettant d'obtenir le nombre total de notices dans la bannette

#28376 : Libellé des sources des veilles
Changement des libellés des sources pour les articles et rubriques du portail.

--------
Editions
--------

#26711 : Fonction de template de notice #parents_authors_by_type_with_tpl();
Possibilité d'utiliser des fonctions de template de notice dans le dernier paramètre, comme pour la fonction #authors_by_type_with_tpl();

#29070 : Editions et transferts
Ajout d'une édition listant les réceptions.

#29175 : Fonction de template de notice #vignette();
Ajout d'une fonction de template de notice qui renvoie la vignette telle qu'affichée à l'OPAC.

#30004 : Formulaire des templates de notices
En création de template, ou si aucune localisation n'a de template spécifique, les localisations ne sont pas affichées : elles sont accessibles au clic sur un bouton.

----
OPAC
----

#21160 :  Personnalisation de la boite de connexion
Ajout d'un placeholder sur le champ identifiant et mot de passe en connexion Opac

#26025 : Navigateur par localisation / section
Optimisation de requêtes dans le navigateur par localisation / section.

#26357 : Template common : ajout du lien "Ajouter le résultat dans le panier" pour les dépouillements de bulletin
Ajout du lien "Ajouter le résultat dans le panier" dans les affichages détaillés django 'common' pour les les dépouillements de bulletin avec et sans notice.

#26820 : Critère de recherche "Nouveauté"
Ajout du critère de recherche "Nouveauté" dans les recherches OPAC.

#27017 : Focus sur l'input texte de la recherche à opac
Ajout du paramètre opac_focus_user_query pour activer ou pas le focus sur le champ de recherche à l'opac

#27124 : Classe d'affichage personnalisée IREPS
Cacher la ligne "Autre titre" si l'on est sur une notice de périodique.

#27679 : Prolongation impossible à l'opac
Ajout de messages permettant d'expliquer l'impossibilité de prolonger un prêt.

#27886 : Mauvaise authentification de l'emprunteur à l'opac
Ré-affichage du formulaire de connexion sous le message d'authentification incorrecte.

#28063 :  Affichage réduit d'une notice dans un affichage django détaillé de notice.
Possibilité d'afficher une notice liée sous sa forme réduite.

#28072 : Affichage du tableau des documents numériques dans l'affichage détaillé common des bulletins sans notice
Ajout de la variable display_explnum utilisable dans bulletin_without_record_extended_display.tpl.html

#28161 : Modification du titre de série et du numéro de partie dans les templates djangos common de notices
Dans l'affichage django réduit de notices pour les monographies, déplacement du titre de série et du numéro de partie vers le titre.
Dans l'affichage django étendu de notices pour les monographies, ajout d'une condition d'affichage prenant en compte le numéro de partie même s'il n'y a pas de titre de série.

#28427 : Transfert de panier anonyme
Nouveau paramètre OPAC : integrate_anonymous_cart
L'activation de ce paramètre permet de proposer à l'usager le transfert des notices ajoutées dans le panier anonyme vers son panier lors de l'authentification. 

#28748 : Ajout d'informations dans les templates common djangos de notices
Ajout du statut de la notice sous la vignette en affichage détaillé.
Ajout du champ "Titre propre d'un auteur différent" en affichage détaillé d'une monographie.
Ajout du champ "Autre éditeur" en affichage détaillé d'une monographie et d'un périodique.
Ajout du champ "Matériel d'accompagnement" en affichage détaillé d'une monographie, d'un périodique et d'un bulletin.
Ajout des sous-champs de "Titre uniformes" en affichage détaillé.

#28947 : Panier à l'opac
Ajout d'un paramètre 'simplified_cart' permettant l'affichage simplifié du panier.

#29106 : Liens "Mot de passe oublié" et "Pas encore inscrit ?"
Ajout de balises class sur les deux liens.

#29261 : Vignette de l'étagère
Affichage de la vignette sur la page de l'étagère.

-------
Portail
-------

#25897 : Ajout d'un document dans une collection numérique
Par défaut, le titre du document reprend le nom du fichier. La liste des documents de la collection est triée par titre de document, puis par ordre d'enregistrement en base.

#26792 : Responsive,  nouvelle condition d'activation de la fonction toggle du module de connexion
En mode responsive (uikit), nouvelle condition d'activation de la fonction toggle du module de connexion.

#27236 : Affichage des articles en tableau dans la gestion du contenu éditorial
Ajout du type de contenu et titre, avec un lien sur le titre qui permet d'accéder à l'édition de l'article

#27660 :  Portfolio / Calcul et choix de la vignette
- calcul de la vignette à partir de la 1ère page si PDF
- forcer la vignette à partir de la liste des mime-type
- permettre d'uploader une vignette

#29059 : Ajout des variables get et post dans le carrousel
Ajout des variables get et post dans la méthode render du carrousel.

#29579 : Modification du contenu éditorial
Mise en place d'une alerte lorsqu'on quitte la rédaction d'un article ou d'une rubrique non enregistrée.

#29997 : Ajout d'une source de données pour la liste de notices depuis une catégorie
Permet d'afficher les notices d'une catégorie par le permalink ou un id de catégorie




************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
*                                    CHANGE_LOG_4.2.9                                                                  *
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************


*******************
ANOMALIES

------------
Acquisitions
------------

#22181 : Catalogage depuis une suggestion
Encodage de l'auteur et de l'éditeur dans les popups pour une compatibilité avec tous les navigateurs et reprise de la date de publication.

#23650 : Emails de suggestions
Remplacer le code de retour à la ligne par une balise "<br />" si les emails sont configurés pour être envoyés au format HTML.

#25316 : Page blanche en réception
Correction d'une inclusion générant une page blanche en réception d'exemplaires.

--------------
Administration
--------------

#21990 : Gestionnaire des tâches arreté
Le gestionnaire des tâches s'arrêtait à cause de fonctions avec le même nom entre les fichiers d'import de gestion et ceux de z3950

#21654 : Libellés des tris disponibles
Changement du séparateur entre les différents tris saisis dans le paramètre OPAC default_sort_list, afin de pouvoir utiliser la fonction #message_lang()


#23725 : Connecteur Pubmed
Mise à jour du connecteur Pubmed.

#24382 : Modification / Amélioration des scripts d'échange Ascodocpsy
Modification / Amélioration des scripts d'import et d'export pour les fichiers Ascodocpsy en ascii.

#24454 : Connecteur Zotero
Correction de la récupération de l'issn et des dates pour les articles générant des bulletins.

#24932 : Validité des connecteurs OAI sortants et rétro-compatibilité
La validité OAI-PMH des connecteurs OAI sortants se paramètre sur le connecteur et n'est pas activé par défaut, afin de rester rétro-compatible.

#25563 : Encodage dans les connecteurs OAI et Webservices PMB
Les caractères spécifiques à l'encodage Windows-1252 n'étaient pas gérés correctement lors des échanges avec des connecteurs OAI et WebServices PMB.

#25645 : Suppression d'une autorité personnalisée
Le bouton supprimer d'une autorité personnalisée est caché dès lors que l'autorité est utilisée.

---------
Autorités
---------

#21849 : Application du paramètre utilisateur Nombre d'enregistrement par page en gestion d'autorités
Report en 4.2 de l'application du paramètre sur les listes d'autorités.

---------
Catalogue
---------

#21368 : Dates de début et de fin d'abonnement
Les dates de début et de fin d'abonnement ne peuvent outrepasser celles du ou des modèles associés.

#21419 : Recherche simple en gestion
Correction de la requête générée par le croisement d'une recherche simple "Titre = *" avec un type de document.

#21939 : Champ Nouveauté en import Z39.50
Ajout du champ Nouveauté sur le formulaire de la notice à importer, et prise en compte de la valeur par défaut du paramètre utilisateur.

#22096 : Affichage des notes en partie gestion
Harmonisation de l'ordre d'affichage des notes.

#22167 : Action édition d'un panier
Correction de l'url des documents numériques

#22472 : Rectification de la taille du tableau des documents numériques dans le catalogue


#22708 : Recherche de catégories
Correction en recherche multi-critères du critère "Catégories avec autopostage", en sélection d'autorité.

#22932 : Impression des relations
Correction de l'affichage de toutes les relations horizontales lors de l'impression d'une notice depuis la gestion.

#23246 : Pied de page de la fiche de circulation
Passage des libellés des champs en fichier de message, permettant la traduction et évitant les erreurs d'encodage en utf-8.

#23597 : Impression des étiquettes de cote par panier
Possibilité de gérer la couleur de la police dans l'impression des étiquettes de cote par panier

#24206 : Grille de catalogage
Correction d'une erreur javascript pouvant bloquer le chargement de la grille de catalogage.

#24208 : Recherche tous champs sur l'année d'édition
Correction de l'indexation de l'année d'édition pour la recherche tous champs.

#24559 : Impression d'un résultat de recherche
En gestion, insérer une ligne entre les notices si aucun template n'est sélectionné, insérer un retour à la ligne si un template est sélectionné.

#24611 : Impression des étiquettes de cote en utf8
Modification du script de génération d'etiquettes de cote afin de prendre en compte la police définie dans les paramètres (pdf_fonffixed).

-----------
Circulation
-----------

#21427 : Sauvegarde du site de gestion par défaut dans le dashboard circulation
Correction de l'anomalie bloquant la sauvegarde du site de gestion par défaut à partir du tableau de bord.

#21440 : Envoi de relances multiples
Harmonisation du pied de page entre la lettre de relance multiple et la lettre de relance individuelle.

#21761 : Temps de chargement des lecteurs d'un panier
Le temps de chargement des lecteurs, dans un PMB où les vues sont activées, était excessivement long

#22292 : Bulletins en circulation
Correction de l'affichage des documents à faire circuler.

#22467 : Inclure un template en mailing emprunteurs
Correction de l'inclusion d'un template si l'éditeur javascript TinyMCE est en version 4.

#22853 : Lenteurs lors du prêt et du retour
Lorsque que l'on effectuait un prêt ou un retour pour un lecteur avec beaucoup de prêt en cours, malgré la configuration de la limite d'affichage du nombre de prêt, la page était très lente à charger.

#23869 : Réservation et transferts
Correction de l'affectation d'une réservation lors de la suppression d'une autre réservation en gestion.

#24462 : Dépliage fiche emprunteur
Correction du double appel au dépliage de la fiche emprunteur.

#25320 : Redirection sur prêt inconnu
Suppression de la redirection vers un nouvel emprunteur lors d'une tentative de prêt d'un exemplaire inconnu.

#25669 : Recherche avancée en circulation
Correction du changement de page sur le résultat d'une recherche avancée. Mise en avant du lien de recherche sous forme de bouton.

--------
Demandes
--------

#22047 : Nouvelle action sur une demande
Correction du bouton "Ajouter une action" qui modifiait la dernière action créée.

------
Divers
------

#21260 :  Correction mail html en Gestion
Déplacement $emailcontent dans la balise html.

#21855 : Calcul du nombre de jours
Correction de la méthode get_open_days qui pouvait renvoyer un nombre à virgules.

#22188 : Harmonisation des langues
Ajout des codes ina et int manquants selon certaines langues, et correction du code ine parfois doublé.

#22582 : Rectification de l'affichage de la documentation des "external services"

#22726 : Webservices : Exécution de Procédures
Lors de l'appel de procédures par les Web services, prise en compte de l'encodage requis pour le connecteur.
Le connecteur json-RPC impose par exemple un transfert en UTF-8 qui n'est pas respecté si l'installation est en ISO-8859-1.

#22890 : Drag n Drop : Conflits de fonctions Javascript
Corrections avec plusieurs types d'éléments pouvant être déplacés en drag n drop sur la même page.
Exemple : Le drag n drop de concepts en édition de notice ne fonctionnait pas.

#23780 : Affichage des vignettes de notices
Correction de l'affichage des vignettes quand celles-ci sont proxifiées.

#24041 : Recherche dans les catégories avec autopostage
Modification de la requête de recherche par autorité dans les catégories avec autopostage pour utiliser une table temporaire.

#24765 : Critères de recherche
Suppression des critères <, >, <= et >= pour les champs personnalisés basés sur une autorité, en recherche multi-critères.

#25008 : Mise à jour de dojo
Mise à jour de dojo pour palier aux problèmes de touch sur les pagéos.

#25271 : Correction du dépot de documents numériques par le Webdav
Prise en compte de la date de parution lors de la sauvegarde de la notice associée, si les informations du document le permettent.

---
DSI
---

#21728 : Remplissage de bannette privée
Prise en compte des paramètres OPAC allow_term_troncat_search et exclude_fields pour le remplissage en gestion d'une bannette privée.

#22064 : Item d'une veille depuis la base
Correction de la date de parution de l'item.

#22486 : Logo d'un item d'une veille
Correction de l'affectation des logos des items.

#22599 : Afficher le nombre de notices dans une bannette privée
Correction de l'enregistrement du champ "Afficher le nombre de résultats dans le mail"

#22611 : Diffusion de bannettes
Ne pas afficher l'icone de drag d'une monographie liée en diffusion de bannette

#23308 : Heure de publication d'un item de veille
Correction du format de l'heure de publication pour les items d'une veille

#23665 : Veilles : items pour la source "notices de la base"
Correction de la récupération du résumé en double.

#24338 : Options RSS des veilles
Correction du dépliage des options RSS des veilles.

#24608 : Rafraichissement des veilles
Correction du rafraichissement des items au changement d'une veille.

#25548 : Sélecteurs de localisation en DSI
Application du paramètre utilisateur permettant de rechercher par défaut dans toutes les localisations.

--------
Editions
--------

#21353 : Circulation simplifiée et titre de périodiques
Correction de l'encodage des titres de périodiques si le charset est en utf-8

#21449 : Edition des relances d'adhésion
Prise en compte des filtres pour l'envoi de toutes les relances ainsi que la mise en panier des emprunteurs.

#21661 : Fonction de notice de template #format_date()

Ajout de la fonction dans la documentation, et prise en compte de la date du jour selon la valeur du deuxième paramètre.

#23904 : Notice de template
Correction de deux tableaux mal initialisés

----
OPAC
----

#21314 : Optimisation du calcul des facettes

#22131 : Correction de requêtes SQL
Sécurisation des requêtes sur l'identifiant dans l'ajout de notices dans un panier. 

#21303 : Saisie des demandes à l'OPAC
Blocage de la saisie des demandes à l'OPAC si aucun thème ou aucun type n'a été configuré.

#21421 : Création d'alerte par l'emprunteur
Correction des messages générés pour l'entête de l'email dans le cas d'un PMB en utf-8.

#21444 : Prêt court  et prolongation
Blocage de la possibilité de prolongation d'un prêt court par l'emprunteur.

#21593 : Réservations et templates Django
Correction du template d'affichage du bouton de réservation pour les bulletins sans notice.

#21596 : Prise en compte de l'affichage des vignettes sous la forme "data:image..."
Les vignettes saisies sous la forme "data:image/..." sont directement affichées dans la page, sans passer par la fonction get_image.

#21631 : Fichiers temporaires des requêtes de recherche
Correction de la génération des fichiers temporaires sur changement de langue de l'interface.

#21774 : Téléchargement du document numérique
Correction du nom de fichier lors d'un téléchargement de document numérique.

#21804 : Tri sur une étagère
Correction de l'application d'un tri sur une étagère.

#21999 : Enrichissement des bulletins
Correction de l'enrichissement des bulletins en affichage django.

#22133 : Correction de l'affichage du libellé de la relation entre notices dans les templates django de notices

#22148 : Tri d'un panier
Correction de l'application d'un tri sur un panier

#22176 : Affichage des sous-collections
Correction d'un div mal fermé.

#22420 : MAJ Paramètre OPAC etagere_notices_format
MAJ du commentaire pour signaler qu'il est possible d'utiliser les nouveaux affichages de notices dans le contenu d'une étagère.

#22458 : Correction de requêtes SQL
Sécurisation des requêtes sur l'identifiant pour les documents numériques.

#22510 : Balise H3 login_invite dans le bloc de connexion
Suppression du contenu caché quand l'utilisateur est connecté, pour faciliter le travail sur la css.

#22583 : Accessibilité du panier
La taille du panier change sur changement de l'accessibilité.

#22592 : Navigation opac
Correction de la recherche avancée intégrant la navigation par section.

#22909 : Historique sur recherche simple
Correction de l'application de l'historique depuis une recherche simple sur catégorie.

#23020 : Nom des tables temporaires
Modification de la génération des noms des tables temporaires pouvant affecter les recherches.

#23598 : Ajout d'une condition d'affichage de l'onglet détail quand il y a des enrichissements dans les affichages django de notices

#23903 : Suppression de la condition d'affichage du permalink pour l'affichage django réduit des notices

#23961 : Affichage de notice personnalisé dans les flux RSS
On tient compte du paramètre "notice_affichage_class" pour utiliser un fichier personnalisé pour l'affichage des notices dans les flux RSS.

#23982 : Correction d'une traduction dans le fichier de messages en_UK

#24153 : Ajout de l'indexation décimale dans les templates django pour l'affichage étendu des articles 

#24279 : Erreur à la sélection dans l'onglet perio a2z
Correction d'une erreur javascript à la sélection d'un périodique dans l'onglet A2z à l'opac.

#24367 : Affichage des avis
Correction de l'affichage des avis dans les templates django.

#24507 : Ajout d'une classe dans les affichages Django de notices
Ajout de la classe uk-clearfix à la div .parentNotCourte dans les affichages réduits.

#24686 : Blocage du serveur web si dans une infopage l'affichage d'une étagère est mal renseigné
Correction pour éviter le blocage du serveur web si dans une infopage l'affichage d'une étagère est mal renseigné (Expl: !!etagere_see28,5,2,1,1! au lieu !!etagere_see28,5,2,1,1!!)

#24820 : Mise à jour du fichier de la police Open Sans
Modification des valeurs dans la feuille CSS de la police Open Sans (font-weight, font-style ...)

#25029 : Correction injection SQL et XSS
Correction injection SQL et XSS pour l'affichage des bulletins, la navigation par page et la navigation par sur-localisation/localisation/section.

#25437 : Flux RSS des résultats de recherche et classe d'affichage personnalisée
Correction de l'affichage du flux en cas de classe d'affichage personnalisée

-------
Portail
-------

#22495 : Mise à jour de sécurité
Correction d'injections SQL éventuelles via le portail

#21627 : Cadres de portail avec plusieurs conditions
Correction de la mauvaise gestion des conditions multiples

#21881 : Intégration du cadre de recherche par termes dans le chaînage du portail
Prise en compte du cadre de recherche par termes dans le chaînage du portail.

#22077 : Ajout de document au portfolio
Prise en compte du paramétrage du serveur pour la taille maximum du fichier à ajouter au portfolio.

#22544 : Rubriques : Construction des liens
Modules "liste de rubriques" et "rubrique" : application des paramètres "construction du lien pour les rubriques" et "construction du lien pour les articles" à tous les niveaux

#23036 : Flux RSS : Date de publication
Récupération de la date de publication à partir de la balise <pubDate> lorsque celle-ci est présente en lieu et place de la balise <date>.

#24669 : Conditions d'affichage : tri des pages OPAC + étagères en double
Tri alphabétique de la liste des pages OPAC.
Correction de libellé : "Etagère" au singulier et "Etagères" au pluriel.

#25447 : Prises en compte des champs génériques dans le filtrage des contenus éditoriaux
Dans les modules listes d'articles et de rubriques, si le filtre basé sur la valeur d'un champ d'un type de contenu est un champ générique, le filtrage ne fonctionnait pas.

#25704 : Correction affichage cadre du portail
Certains cadres s'affichaient anormalement dans la page "perio_a2z" alors que dans leurs conditions d'affichage "page", il y avait juste "notice_display" de renseigné. C'est résolu.


*******************
EVOLUTIONS

------------
Acquisitions
------------

#21584 : Edition des suggestions
Ajout d'un bouton dans la liste des suggestions permettant de les éditer au format Excel.

--------------
Administration
--------------

#21694 : Fonction de consolidation des statistiques #adresse_ip_forward()
Permet de récupérer l'adresse IP de l'utilisateur derrière un proxy.

#22184 : Liste des suggestions
Prise en compte du paramètre utilisateur "Nombre d'enregistrement par page -> En recherche" pour l'affichage de la liste des suggestions.

#22513 : Mailing emprunteur
Ajout des informations de localisation de l'emprunteur dans les templates de mail.

#22888 : Statistiques sur bannettes publiques
Ajout des fonctions de consolidation des statistiques #abo_bannette et #desabo_bannette permettant d'identifier les inscriptions et les desinscriptions depuis le compte lecteur.

#23098 : Localisations du calendrier
Possibilité de cocher/décocher toutes les localisations du calendrier.

#23336 : Métadonnée date pour le format d'export Dublin Core
Ajout de la métadonnée "Date" si la date de parution de la notice a pu être calculée depuis le champ de notice Année.

#23352 : Doublons de notices après import
Ajout d'un critère de recherche permettant de retrouver toutes les notices en doublon sur l'ISBN après un import.

#23622 : Import de statistiques opac
Amélioration de l'ergonomie lors de l'import d'une statistique.

#23863 : Dépliage de la liste des paniers
Ajout d'un paramètre utilisateur définissant le dépliage ou non par défaut des paniers de l'onglet catalogue.

#24162 : Conformité des entrepôts OAI
Mise en conformité des entrepôts OAI avec les validateurs http://re.cs.uct.ac.za/ et http://validator.oaipmh.com/

#24430 : Import lecteurs GENES
Possibilité de faire uniquement un ajout des nouveaux étudiants pour l'ENSAE.

#24516 : Format Dublin Core pour la bibliothèque numérique Gallica
Mise en conformité du format Dublin Core selon les recommandations de la BNF pour la bibliothèque numérique Gallica

#24710 : Dépliage des classements
Modification du paramètre utilisateur "Paniers du catalogue dépliés par défaut" pour qu'il s'applique également sur les paniers en circulation, les étagères et les infopages.

---------
Catalogue
---------

#21279 : Liste des répertoires de documents numériques
Tri alphabétique de la liste des répertoires.

#21287 : Affichage du commentaire des exemplaires
Les retours à la lignes sont pris en compte à l'affichage, en gestion et à l'OPAC, pour les exemplaires de monographies.

#21454 : Recherches prédéfinies en gestion
Création d'un permalink pour accéder aux recherches prédéfinies

#21471 : Champs de la liste de circulation
Ajout de la localisation des lecteurs dans les champs possibles de la fiche de circulation

#21559 : Edition d'un panier d'exemplaires
Amélioration des informations de notices exportées lors de l'édition d'un panier d'exemplaires

#21789 : Libellé OPAC "Document/périodique/article"
Ajout d'espaces avant et après les /.

#22590 : Sélecteur de notice
Possibilité de rechercher une notice par son identifiant si le paramètre pmb_show_notice_id est activé.

#23662 : Tableau des exemplaires
Possibilité de trier les exemplaires en cliquant sur les entêtes de colonnes.

#24044 : Export de panier en gestion
Le nom du fichier généré commence par une version nettoyée du nom du panier.

#24174 : Recherche d'exemplaire
En gestion, si la recherche par code-barre ne renvoie qu'un seul exemplaire de bulletin, le bulletin est directement affiché.

#24248 : Champ de notice Droit d'usage
Ajout du champ de notice Droit d'usage, liste contrôlée en administration.

-----------
Circulation
-----------

#21296 : Relance et localisation des exemplaires
Affichage du filtre par localisation des exemplaires, même si les transferts ne sont pas activés.

#21547 : Code-barre en création d'emprunteur
Quand la génération du code-barre emprunteur est automatique (paramètre général num_carte_auto à 1 ou 2), proposition de code-barre différent si plusieurs utilisateurs saisissent en même temps. Ne fonctionne pas pour les scripts personnalisés de génération de code-barre emprunteur (paramètre général num_carte_auto à 3).

#22007 : Informations supplémentaires pour le mailing emprunteur
Ajout des dates de début et de fin d'adhésion.

#22752 : Ajout de l'impression du ticket de prêt sur les imprimantes prévues à cet effet
Ajout du pictogramme permettant l'impression du ticket de prêt via l'imprimante à ticket.

#22943 : Création d'emprunteur
Possibilité d'inclure un script personnalisé sur le formulaire de création et de duplication d'emprunteur, afin notamment de personnaliser le mot de passe pour l'opac.

#22980 : Téléphones de la fiche emprunteur
Ajout du préfixe "Tél. :" devant les téléphones de la fiche emprunteur.

#23516 : Test sur l'année de naissance de l'emprunteur
Si le paramètre emprunteur birthday_optional est à 0, déplacement du test de vérification du champ avant l'envoi du formulaire.

#23733 : Envoi de SMS
Adaptation de la classe d'envoi de SMS via smstrend pour pouvoir paramétrer le type de message

#23835 : Ouverture fiche emprunteur
Possibilité d'ouvrir une fiche emprunteur dans un nouvel onglet, par la combinaison Ctrl + clic.

#23897 : Recherche emprunteurs avancée
Ajout des filtres et tris présents en recherche simple d'emprunteurs dans la recherche avancée.

#23914 : Amélioration de la gestion de la RFID dans PMB
Divers améliorations du protocole SIP2 pour la RFID avec PMB.

#24309 : Prolongation en lot
Possibilité de forcer la prolongation en lot.

#24370 : Recherche d'emprunteur
En recherche simple, si un code-barre unique n'est pas trouvé, on recherche sur un nom ou un code-barre avec troncature automatique.

------
Divers
------

#19302 : Compatibilité PHP 5.4
Corrections d'erreurs "strict".

#21539 : Message sur la page de connexion
Possibilité d'ajouter un message sur la page de connexion, via le paramètre général 'login_message'.

#21942 : Utilisation des polices pour les formulaires dans les styles de gestion

#22519 : WebServices : Facettes
Nouvelles fonctions dans l'API PMB :
- pmbesSearch_listFacets($searchId, $fields = array(), $filters = array())
- pmbesSearch_listRecordsFromFacets($searchId, $filters = array())
- pmbesOPACEmpr_listFacets($session_id, $searchId, $fields = array(), $filters = array())
- pmbesOPACEmpr_listRecordsFromFacets($session_id, $searchId, $filters = array())
- pmbesOPACAnonymous_listFacets($searchId, $fields = array(), $filters = array())
- pmbesOPACAnonymous_listRecordsFromFacets($searchId, $filters = array())

#24751 : Connecteur OAI HAL
Ajout d'une feuille de transformation XSL afin de récupérer correctement les url associées des notices provenant du connecteur OAI HAL.

#25388 : Modification des informations du module "Demandes" dans le tableau de bord
Suppression de la ligne "documents dans le fonds".
Ajout du nombre total de demandes et du nombre de demandes par état (à valider, validées, refusées, terminées, abandonnées et archivées).

---
DSI
---

#22108 : Bannette privées et templates
Possibilité d'utiliser les templates de bannettes pour les bannettes privées à l'aide du paramètre private_bannette_tpl.

#22619 : Templates de bannettes et django
Possibilité d'utiliser les fonctions pmb de template django dans les bannettes.

#23093 : Création de notice depuis les veilles
Ajout de la détection de notices similaires quand on crée une notice depuis un item de veille.

#24155 : Items supprimés d'une veille
Ajout de la possibilité de masquer les items supprimés d'une veille.

#24740 : Suppression d'un tag d'un item de veille
Ajout d'une icone permettant de supprimer un tag dans un item de veille.

#25614 : Veilles : Contenu de l'item non repris en création de notice
Création d'une notice via un item de veille :
- Contenu copié dans la note de contenu

--------
Editions
--------

#21324 : Fonction de template de notice : #subcollection_with_tpl();
Ajout de la fonction de template de notice #subcollection_with_tpl(); permettant de personnaliser l'affichage d'une sous-collection.

#21960 : Fonctions de template de notice #authors_by_type_with_tpl(); et #initiale();
Modification de la fonction #authors_by_type_with_tpl(); afin que le template puisse contenir des fonctions de template de notice, et ajout de la fonction #initiale();

#22136 : Templates de bannettes
Ajout des informations de l'emprunteur et de sa localisation dans les templates de bannettes.

#23101 : Mois dans les templates de notice
Ajout d'une fonction de template de notice #month_in_letters(); qui permet de renvoyer un mois en toutes lettres.

#23846 : Fonction de template #if_empty();
Ajout d'une fonction de template #if_empty(a,b); qui retourne b si a est vide, sinon qui retourne a.

#24312 : Ajout des fonctions de template de notices #set_variable(); et #get_variable();
#set_variable(); permet d'affecter une valeur à une variable, #get_variable(); permet d'afficher la valeur de la variable.

----
OPAC
----

#21348 : Ajout d'un paramètre permettant de ne pas filtrer sur les nouveaux éléments dans les flux rss générés depuis les résultats de recherches opac
Création d'un paramètre short_url_mode prenant:
-Soit 0 (valeur par défaut): On conserve le fonctionnement initial des flux rss générés depuis une recherche (affichage des notices marquées comme nouveautés uniquement) 
-Soit 1: On va afficher toutes les notices trouvées depuis le résultats de recherche (une virgule peut être ajoutée pour spécifier le nombre d'élément maximum à afficher) exemple 1,30 si ce nombre n'est pas spécifié. On reprend la valeur définie dans le paramètre opac_search_nb_results_per_page

#21415 : Ajout des titres des pages dans le fichier de messages pour les pages opac qui n'ont pas de <title>

#21433 : Annulation de réservation à l'OPAC
Ajout d'une demande de confirmation lorsqu'un emprunteur veut annuler une réservation via son compte à l'OPAC.

#21543 : Personnaliser l'email d'inscription à l'OPAC
Possibilité d'utiliser !!empr_first_name!! et !!empr_last_name!! afin de personnaliser le message envoyé dans le corps de l'email d'inscription à l'OPAC.

#21589 : Affichage du panier à l'OPAC
Ajout d'une class différente sur l'élément span "cart_info_iframe_content" si le panier est vide ou non.

#21933 :  Encapsulation du tri dans les résultats de recherche

Le détail du tri appliqué et du bouton de choix d'un tri sont maintenant encapsulé dans un <span> possédant une classe "triContainer".

#21979 : Ajout des connecteurs dans les templates django
Ajout d'un lookup au fichier pmb_h2o.inc.php permettant d'accéder aux fonctions/attributs des connecteurs.

#22119 : Encapsulation des inputs de la recherche simple en OPAC
Ajout d'une balise <span> encapsulant les différents inputs de la recherche simple à l'OPAC.

#22240 : Zotero et titres de notice
Ajout du complément de titre dans les éléments récupérés par Zotero.

#22511 : Tableau des états de collection
Ajout d'une classe sur le tableau.

#22572 : MAJ Paramètre OPAC bannette_notices_format
- MAJ du commentaire pour signaler qu'il est possible d'utiliser les nouveaux affichages de notices dans le contenu d'une bannette.

#22759 : Ajout des sous-collections dans l'affichage étendu des templates Django de notice

#22802 : Ajout d'un paramètre permettant de masquer les boutons de dépliage de notices à l'opac
Ajout d'un paramètre opac_recherche_show_expand permettant d'inclure ou non les boutons "+" et "-" qui déplient ou replient toutes les notices des résultats de recherches.

#22915 : Ajout du numéro dans la collection dans les affichages Django détaillés de notices

#23039 : Fil d'Ariane des catégories
Ajout d'une classe permettant de styler le fil d'Ariane des catégories.

#23557 : Changement d'url connecteur ArteVOD
Application de la nouvelle url pour le connecteur ArteVOD

#23701 : Flux RSS des résultats de recherche
Mise en cohérence de l'affichage du flux RSS des résultats de recherche avec l'affichage des flux RSS générés en DSI.

#23826 : Refus de l'emprunteur d'être tracé par les cookies
Possibilité de personnaliser le message affiché quand l'emprunteur a configuré son navigateur afin de ne pas être tracé par les cookies.

#24039 : Afficher les prêts précédents
Ne pas afficher les prêts en cours dans la page des prêts précédents de l'emprunteur.

#24121 : Nom des listes de lecture
Vérification de l'unicité des noms de liste de lecture par emprunteur.

#24157 : Affichage du bloc lvl1
Elimination des espaces au sein du bloc lvl1 s'il est vide.

#24315 : Déplacement du champ "relation_up" sous le titre de la notice dans les affichages Django détaillés des notices

#24331 : Ajout d'informations pour les notices filles dans les affichages Django détaillés de notices
Informations ajoutées :
- Titre de série
- numéro dans la série
- Titre du périodique / bulletin
- Auteur principal
- Année

#24521 : Impression de panier à l'OPAC
Ajout d'un paramètre permettant de cacher l'option "Documents numériques"

#24523 : Gestion des alertes dans le compte emprunteur
- création d'un code message permettant de dissocier "Créer une alerte" dans le compte emprunteur et dans les résultats de recherche
- si le paramètre OPAC allow_bannette_priv est à 2, le bouton "Créer une alerte" dans le compte emprunteur renvoie sur une recherche simple

#24690 : Autolevel2 et historique de recherches
Si le paramètre OPAC autolevel2 est à la valeur "2", relancer une recherche par l'historique des recherches ne repasse pas par le level 1.

#24990 : Ajouter les documents en prêt au panier
Ajout d'un bouton sur la fiche lecteur permettant d'ajouter au panier les documents prêtés.

#25284 : Envoi par email du panier à l'OPAC
Ajout d'un expéditeur possible pour l'email envoyé.

#25295 : Navigation dans la visionneuse : permettre d'aller à un numéro de page
Possibilité d'aller directement à un numéro de page au travers du champ de saisie avec l'aide de la touche Entrée.

-------
Portail
-------

#21790 : Amélioration de la qualité des images réduites dans le portail
Modification de la méthode de réduction des images afin d'obtenir des images de meilleure qualité une fois réduites.

#22023 : Versions du portail
Ajout de l'information utilisateur dans les versions du portail.

#22492 : Url d'un document du portfolio
Affichage de l'url dans le formulaire d'édition d'un document du portfolio.

#23090 : Contenu éditorial : Sélecteur de "rubrique parente"
Ordonnancement du sélecteur de rubrique parente en édition d'article ou de rubrique.

#23948 : Collection numérique
Tri par titre des documents d'une collection numérique

#24101 : Modification de la feuille de style ZEN
Optimisation de l'affichage des flux rss en page d'accueil.

#25490 : Ajout de l'article dans le fil d'Ariane
Si la source le permet, on ajoute les informations de l'article courant dans les informations disponibles pour le fil d'Ariane.


*******************
DEVELOPPEMENTS

--------------
Administration
--------------

#24175 : Ajout du type "intervalle de dates" dans les champs personnalisables

---
DSI
---

#23584 : Veilles : Surveillance de site web
- Nouvelle source de données "Surveillance de sites web"
Pré-requis : Extension PHP XDiff

#25854 : Veilles : Expressions booléennes
Possibilité de filtrer les nouveaux éléments entrants en appliquant une expression booléenne au niveau de la veille et/ou au paramétrage de la source.

----
OPAC
----

#24001 : Lien de partage d'un résultat de recherche
Génération d'un lien permanent vers une recherche OPAC.

-------
Portail
-------

#23082 : Implémentation d'une gestion de "Toolkits"
- Paramètre d'activation "active_toolkits" dans la partie "Portail" des paramètres d'administration.
- Nouvel onglet "Toolkits" en construction de portail.
- Chargement des toolkits (Jquery et Uikit) disponibles dans le répertoire pmb/opac_css/styles/common/toolkits.




************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
*                                    CHANGE_LOG_4.2.8                                                                  *
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************


*******************
ANOMALIES

------------
Acquisitions
------------

#17808 : Ordre des rubriques en commande
Correction de l'affichage des rubriques dans les commandes

#19462 : Facturation suite à une commande
Correction du calcul de dépassement de budget en enregistrement de facture.

#21173 : Titre de l'abonnement avec accents dans un bon de commande
Lors de la sélection d'un abonnement dans un bon de commande, le titre du périodique n'était pas affiché dans la ligne de commande s'il contenait des accents.

--------------
Administration
--------------

#16933 : Conversion de notices
En conversion, adaptation de la sortie à l'encodage du PMB en cas de transformation xslt.

#17044 : Modification des conversions MEDLINE ET RIS
Corrections de cas particuliers pouvant poser problèmes concernant les ID DOI, les notes et résumés et les titres de pério

#17138 : Affichage d'information lors de l'execution d'une tâche de synchronisation de connecteur
Les informations relatives à l'exécution d'une tâche de synchronisation de connecteur n'étaient pas affichées dans le bilan de la tâche.

#17262 : Tâche programmée de façon répétée en fonction d'un horaire.
La répétitivité horaire d'une tâche n'était pas respectée. (Expl: horaire: 9-18{2})

#17436 : Correction de l'affichage des messages dans le connecteur Bibloto
Définition de messages multi-lingues. Gestion de l'UTF8.

#17683 : Accès aux WebServices externes de PMB avec un utilisateur en langue anglaise
L'accès aux WebServices "Commons" de PMB en anglais était impossible 

#17743 : Titres de pages en administration
Correction de plusieurs titres de pages

#17822 : Modification / Amélioration des scripts d'échange Ascodocpsy
Modification / Amélioration des scripts d'import et d'export pour les fichiers Ascodocpsy en ascii.

#18006 : Préférences utilisateurs : Mot de passe
Ajout d'un attribut autocomplete='off' pour indiquer au navigateur de ne pas pré-remplir le champ de type 'password' à l'édition d'un utilisateur.

#18272 : Liste des entrepôts
Correction de l'affichage de la liste des entrepôts dans la planification d'une synchronisation.

#18680 : Vignette des documents numériques
Correction de la génération des vignettes sur une tâche planifiée de rattachement des documents numériques aux notices.

#18861 : Diffusion d'une bannette par le planificateur
Changement du libellé du message pour une bannette non arrivée à échéance.

#19227 : Paramétrage de la visionneuse bookreader
Changement de nom pour la classe epubData afin d'éviter une page blanche en paramétrage.

#19333 : Affichage des libellés des vues base ISO
Affichage des libellés de vues avec accent dans les tableaux du menu "affectation des vues" (gestion avancée des vues) pour les PMB en ISO-8859-1.

#20405 : Réindexation planifiée
Correction de quatre requêtes de réindexation par le planificateur de taches.

#21132 : Modification / Amélioration des scripts d'échange Ascodocpsy
Modification / Amélioration des scripts d'import et d'export pour les fichiers Ascodocpsy en ascii.

---------
Autorités
---------

#20569 : Libellé d'un concept
Suppression des espaces éventuels autour d'un libellé de concept.

---------
Catalogue
---------

#16818 : Notice de bulletin et champs nouveauté
Correction de l'enregistrement du champ nouveauté sur les notices de bulletins.

#16824 : Filtre Type de document et statut de notice en gestion
Correction d'une régression qui ne prenait plus en compte le filtre par type de document et celui par statut dans la recherche simple en gestion

#16976 : Indexation des documents numériques avec les concepts
Correction de l'autocomplétion et de la sélection multiple de concepts dans l'édition des documents numériques.

#17039 : Vignette des documents numériques
Ne pas redimensionner la vignette quand on force l'icône de la vignette selon le mimetype.

#17048 : Recherche simple sur les catégories
Correction de la recherche simple sur les catégories dans le cas d'une recherche étoile.

#17171 : Création en double de bulletin lors du bulletinage
Lors de la création de bulletin par le bulletinage, la modification de la date de parution avant d'enregistrer le bulletin donnait lieu à la création de bulletin en double pour le périodique.

#17195 : Recherche avec des mots vides dans tous les champs en mode "et" et avec les documents numériques
La recherche tous les champs en "et" avec les documents numériques ne retournait pas les notices souhaitées si l'on avait des mots vides dans le champ de recherche.

#17316 : Supprimer le tri en cours
Correction du clic sur le bouton "Aucun tri" en sélection de tri, qui restait sur le dernier tri sélectionné.

#17461 : Edition de notice et éditeur javascript tinyMCE
Correction du blocage à l'enregistrement de la notice après changement du type de document si l'éditeur tinyMCE est présent sur un champ du formulaire.

#17509 : Nombre de notices par auteur en recherche d'auteur
Correction du calcul du nombre de notices par auteur, en recherche d'auteur.

#17655 : Recherche dans le sélecteur d'abonnements
Correction de la recherche dans le sélecteur d'abonnements

#17807 : Style carte openlayers
Ajout d'une max-width: 100% sur le conteneur de la carte pour éviter qu'elle ne dépasse sur le reste de la page quand la fenêtre fait moins de 1500px de large environ.

#18128 : Erreur de type "notice" lors de la récupération d'un résultat depuis l'historique de recherches
En réaffichant un résultat de recherche depuis l'historique, ce message était affiché sur la page intermédiaire :
Notice: Undefined index: tri in /var/www/html/pmb/recall.php on line 16
Aucunement bloquant auparavant, mais pouvant surprendre l'usager d'un éventuel problème.

#18209 : Export excel des notices depuis un panier
Correction de la perte des entêtes de certaines colonnes s'il n'y a aucun dépouillement ou bulletin dans le panier exporté en Excel.

#18713 : Indexation des Epub
Correction de l'indexation des documents numériques de type Epub dont la structure interne peut différer.

#18715 : Fichier de recherche multicritères
Correction d'un identifiant en double dans le fichier xml des critères de recherche.

#19015 : Impression du panier en gestion
Correction de l'entête du fichier pour bien gérer l'encodage de l'affichage.

#19318 : Import Z3950
Correction d'une variable globalisée mal initialisée pouvant générer des bulletins sans information.

#19417 : Classement des étagères et des paniers
Correction de l'enregistrement d'un classement qui pouvait parfois obliger à rafraichir la page.

#19473 : Positionnement de la carte
Correction du positionnement de la carte de géoréférencement si un seul point est enregistré.

#19597 : Duplication d'abonnement
Correction du libellé de l'abonnement dupliqué si celui-ci contient un apostrophe.

#19659 : Import modèle Z3950 Agroparistech
Si la notice est un périodique, les informations de série sont basculées en complément de titre.

#20270 : Conservation des catégories en remplacement de notice
Correction d'un bug d'affichage des catégories à conserver.

#21009 : Calcul des numéros cycliques dans le bulletinage
Pour les périodiques avec un modèle cyclique et plusieurs abonnements successifs dans le temps, le calcul des numéros n'était pas correct dans le bulletinage.

-----------
Circulation
-----------

#17042 : Formulaires éditables : Champs personnalisés
Correction d'une anomalie rencontrée sur les formulaires éditables de lecteurs avec des champs personnalisés.

#17337 : Date de fin d'adhésion en duplication de lecteur
Calcul de la nouvelle date de fin d'adhésion en duplication de lecteur, en fonction de la catégorie du lecteur dupliqué.

#17744 : Modification d'une liste de circulation lorsqu'un exemplaire l'utilisant est en circulation
Stockage de la liste de circulation au moment de la mise en circulation d'un exemplaire de bulletin pour que la modification de la liste en question n'impacte pas la circulation en cours.
Fonctionne également lors de la duplication du paramétrage d'une liste de circulation sur une autre.

#17863 : Suppression d'un périodique
Suppression des demandes d'abonnement aux listes de circulation lorsqu'on supprime un périodique.

#18037 : Virgule dans les prix d'exemplaires
Prise en compte de la virgule dans les prix d'exemplaires lors d'un passage en recouvrement, évitant l'arrondi de la somme due.

#18296 : Icone de demande de transfert
Sur le tableau des réservations en cours, affichage de l'icone de demande de transfert si tous les rangs précédents des réservations de la notice sont validables ou validés par un exemplaire local, et si le rang en cours peut être validé par un exemplaire transférable depuis une autre localisation.

#18957 : Liste des prévisions de réservation
Filtrage sur les quantités restantes différentes de zéro pour les listes "Prévisions validées", "Prévisions non validées" et "Prévisions validées non confirmées". Ajout également de la quantité restant à traiter dans la colonne "Quantité".

#19031 : Blocage d'un prêt de document
Vérification d'un prêt existant sur l'exemplaire demandé avant de vérifier les quotas de prêts éventuellement mis en place.

#19174 : Réservations planifiées traitées
Ne pas tenir compte des réservations planifiées dont la quantité restante est à 0 en retour de document.

#20606 : Droits sur l'édition d'une liste de prêts d'un groupe
Un utilisateur n'ayant pas accès au module "Editions" peut désormais générer la liste des prêts à partir d'un groupe de lecteurs dans le module "Circulation".

--------
Demandes
--------

#20695 : Création d'une nouvelle demande
Correction d'une erreur à la création d'une nouvelle demande si les droits d'accès sont activés.

------
Divers
------

#17701 : Répertoire de cache H2o
Modification du répertoire utilisé par H2o pour le cache des templates Django.

#17883 : Correction Webav et métadonnées avec des apostrophes
Le mappage des métadonnées contenant une apostrophe faisait planter l'enregistrement de la notice.

#18391 : Affichage des exemplaires numériques
Dans certains cas les exemplaires numériques ne s'affichaient pas. (Opac et Gestion)

#18534 : Téléchargement des documents numériques depuis les paniers
Correction des noms de fichiers contenus dans l'archive zip, bloquant l'ouverture de celle-ci.

#18612 : Accès au contenu des documents numériques
Ajout d'une vérification d'existence de fichier dans le répertoire des documents numériques avant d'afficher le contenu.

#19311 : Ajout de l'entête de version cvs dans les fichiers de quotas
Ajout de l'entête de version cvs dans les fichiers de quotas

#19477 : Correction de la génération de vignettes de documents numériques PDF (Windows)
Modification du chemin des documents numériques (chemin absolu).

#19861 : Liens avec attribut target
Correction d'attributs target pour différents liens de documents numériques, en gestion et à l'OPAC.

#20027 : Impression pdf en freeserif
Modification de la font freeserif pour prendre en compte les espaces insécables en utf-8.

---
DSI
---

#16938 : Veilles : rubrique parente par défaut non prise en compte
Prise en compte de la rubrique parente définie dans la veille pour la création d'une rubrique à partir d'un item.

#16955 : Visibilité des documents numériques
Prise en compte du paramètre OPAC show_links_invisible_docnums pour l'affichage du lien vers les documents réservés aux abonnés.

#17080 : Documents numériques et groupement par facettes
Prise en compte de la case à cocher "Ne pas tenir compte du statut des notices" pour la visibilité des documents numériques en diffusion, en cas de groupement par facettes.

#17604 : Indication du nombre de notices diffusées
Apparition de la case à cocher dans les bannettes privées, permettant d'indiquer ou non le nombre de notices diffusées dans l'email.

#18073 : Formulaire de veille
Indication des champs mal renseignés lors de l'enregistrement d'une veille.

#18257 : Vignette des documents numériques en diffusion dsi
L'affichage de la vignette des documents numériques est autorisée si la case "Ne pas tenir compte des status des notices" est cochée dans la bannette.

#18914 : Bannette avec regroupement
Correction d'un pointeur de requête bloquant l'affichage de certaines notices.

#20313 : Recherche de bannette publique
Modification de la recherche de bannette par son nom : la bannette doit contenir la valeur cherchée, plutôt que commencer par celle-ci.

#20585 : Droits d'accès sur les notices créées par le module de veille
Application des éventuels droits d'accès sur les notices créées par le module de veille.

#20826 : Référence à une notice, un article, une section dans les veilles
Dans un item de veille, suppression de la référence à une notice, un article, une section si cet élément est supprimé.

--------
Editions
--------

#17502 : Relance d'abonnement et guillemets
Correction de l'erreur générée par les guillemets dans les paramètres des relances d'abonnement par lettre et email.

#18498 : Impression/Mail de toutes les relances
Correction de la requête d'impression/envoi de mail pour toutes les relances, qui filtrait sur la page en cours du tableau d'édition.

#20541 : Impression/mail de toutes les relances
Correction de la génération des emails.

#20838 : Tenir compte des droits sur les exemplaires numériques en template de notice
Correction de la prise en compte du paramètre "Tenir compte des droits" pour la fonction de template #expl_num_with_tpl();

------
Fiches
------

#18853 : Champ de type liste dans le module fiches
Correction de la saisie multiple pour les champs de type liste.

----
OPAC
----

#17014 : Affichages django des notices : Icônes de panier
L'icône de panier n'est plus la même selon sa présence ou non dans le panier.

#17028 : Navigateur de sections
Correction de la prise en compte des non-classés en navigation par plan de classement.

#17091 : Affichage des onglets de notices
Correction permettant de n'afficher les onglets définis en template que s'ils possèdent du contenu.

#17139 : Affichage des informations du lecteur en connexion automatique
Les informations du lecteur n'étaient pas affichées à la 1ère connexion automatique du lecteur à l'Opac (via un lien dans un mail par exemple)

#17517 : Recherche de catégorie en multicritère
Correction de la recherche multicritères sur les catégories OPAC qui ne filtrait pas sur le thésaurus sélectionné.

#17651 : Accès rapide à l'OPAC
Ajout du message manquant pour l'accès rapide aux réservations planifiées et harmonisation de l'accès rapide entre la page d?accueil et celle du compte emprunteur.

#17685 : Affichage des éditeurs de notices à l'OPAC avec une fonction de template
Les fonctions d'affichage des éditeurs "publisher_with_tpl" et "publisher_1_with_tpl" pour les templates de notice ne fonctionnaient pas à l'OPAC.

#17719 : Classe d'affichage personnalisée vide
Correction de l'erreur si une classe d'affichage personnalisée est déclarée en paramètre OPAC et que ce même paramètre est déclaré vide dans une vue.

#17760 : Critères de tri
Ajout d'un espace après la virgule séparant les différents critères du tri.

#17765 : Demande d'abonnement à une liste de circulation
Prise en compte du paramètre du statut de lecteur pour afficher le bouton de demande.

#17803 : Caractères incorrects
Nettoyage des caractères incorrects pour le parse HTML.

#18051 : Tri des notices sur page d'autorité
Ajout de la valeur "Aucun tri" dans le sélecteur de tri affiché sur la liste des notices d'une autorité, plus cohérent avec l'affichage par défaut.

#18112 : Correction injection SQL
Correction injection SQL pour la page d'autorité auteur.

#18180 : Title manquant sur boutons du panier
Ajout du title sur les boutons du panier : "télécharger les documents numériques du panier" et "télécharger les documents numériques des notices cochées"

#18202 : Facettes sur page d'autorité
Ne pas conserver sur l'affichage d'une page d'autorité les facettes sélectionnées en recherche.

#18464 : Classe sur onglet "Mes prêts/mes réservations"
Conservation de la classe "current" sur l'onglet, quand on clique sur "Afficher les prêts précédents" dans le compte emprunteur.

#18465 : Panier manquant sur la page d'inscription en ligne
Affichage du panier dans la page d'inscription en ligne.

#18600 : Affichage d'une notice
Correction de l'affichage des notices similaires pouvant bloquer l'affichage d'une notice.

#18633 : Correction des templates django en OPAC
Suppression commentaire invalide dans la zone de dépouillement.

#18641 : Classe d'affichage personnalisée ESA
Suppression d'un apostrophe dans le tableau des états des collections.

#18682 : Mise en place d'un mode proxy dans l'OPAC pour le téléchargement des vignettes de notices
Permet d'éviter les avertissements liés à un contenu mixte si le site est en HTTPS et l'URL de la vignette en HTTP.

#18859 : Tri des étagères
Correction de l'affichage du tri par défaut d'une étagère

#19008 : Connecteur Zotero
Correction de l'erreur générée par une recherche externe sur le connecteur Zotero

#19253 : Ne pas afficher certaines colonnes en recherche multi-critères
Correction de la prise en compte de l'attribut notdisplaycol dans le fichier search_fields.xml

#19357 : Onglets personnalisés des notices
Cacher l'onglet si son contenu est vide.

#19492 : MAJ search_fields_gestion.xml
Mise à niveau du fichier XML search_fields_gestion (contenant les critères de recherche sur les notices) avec les dernières évolutions.

#19516 : Affichage avec la visionneuse dans le portefolio pour le portail
L'activation de la visionneuse pour les documents numériques du portail ne fonctionnait pas.

#19725 : Mot de passe oublié
Ne pas tenir compte du paramètre show_login_form_next quand on veut ré-initialiser le mot de passe emprunteur.

#19783 : Facettes et internet explorer
Modification de la gestion des facettes pour une meilleure compatibilité avec internet explorer.

#19903 : Recherche OPAC avec troncature
Correction du calcul des mots recherchés si la troncature à droite est activée.

#19957 : Stats OPAC
- Infos lecteurs manquantes sur certains logs
- Internationalisation de la fonction #multi_facettes(); afin de consolider les recherches avec application de facettes quel que soit la langue OPAC de l'usager.

#20095 : Ordre d'affichage des notices liées
Mise en cohérence entre la gestion et l'OPAC de l'ordre d'affichage des notices liées, tant que celles-ci n'ont pas été ordonnées manuellement.

#20182 : Visionneuse de pdf avec un serveur PMB sous Windows 
La visionneuse ne fonctionnait pas pour les PDF lorsque PMB était installé sur un serveur Windows.

#20258 : Barre d'acceptation des cookies
Mauvaise lecture du paramètre OPAC cookies_consent si l'OPAC est inclus dans un autre site.

#20335 : Visionneuse et Recherches prédéfinies
Correction d'un problème d'affichage de documents numériques dans la visionneuse depuis un résultat d'une recherche prédéfinie

#20548 : Connecteur ArteVOD : format de la date de naissance
Modification du format de la date de naissance pour la connexion automatique sur la médiathèque numérique "ArteVOD".
La date envoyée est le 31 décembre de l'année de naissance de l'emprunteur.

#20620 : Information en double dans l'onglet public
En impression de notice d'article au format public, l'information du numéro de bulletin n'est plus affichée en double.

#20631 : Ajout d'un attribut id sur un champ caché
Ajout d'un attribut id sur un champ caché dans le cadre d'une recherche multicritères.

#20918 : Affichage django des notices : correction du template 'common'
Ajout de la condition d?existence du titre parallèle.
Ajout du type de document pour les notices qui ne sont pas des monographies à la suite du niveau bibliographique.
Ajout de la condition d?existence de la date dans l'affichage étendu des articles.

#21236 : Page incomplète à la création d'une alerte à l'Opac
Lors de la création d'une alerte à partir d'un résultat de recherche à l'Opac et avec une fonction personnalisée de recherche de paramétré, la page n'était pas chargée complétement à cause d'une erreur.

#21249 : Correction mail html en OPAC
Déplacement $emailcontent dans la balise html. Suppression du javascript (spam).

-------
Portail
-------

#16926 : Ajout d'un type='text/javascript' manquant dans l'appel à JQuery
Correction de l'inclusion de JQuery dans le portail. Depuis la dernière modification, le type='text/javascript' avait disparu

#17440 : Notices similaires dans le portail
Application des droits d'accès et de visibilité des statuts de notices dans la source de données "Notices similaires" des cadres du portail.

#17573 : Source de données liste de notices sur un même sujet
Les notices ayant des catégories communes sont triées par nombre de catégories communes décroissant.

#17628 : Cache des logos du contenu éditorial
Correction de la gestion du cache des logos du contenu éditorial

#17886 : Correction messages dans le portail
Certains messages ne correspondaient pas. Rubrique(s) Parente(s) dans le sélecteur de rubriques du module liste de rubriques => le sélecteur est une sélection manuelle.

#18606 : Accès aux concepts dans les templates Django de notices
Les concepts qui indexent une notice sont accessibles dans les templates Django de notices via la variable {{ record.concepts_list.concepts }}.

#18835 : Enregistrement d'un CMS
Correction d'une erreur Javascript à l'enregistrement d'un CMS.

#19201 : Non utilisation du cache à la création de cadres dans le portail
On n'utilise pas le cache à la création d'un cadre dans le portail pour éviter les conflits lorsque l'on utilise plusieurs fois le même type de sélecteur.


*******************
DEVELOPPEMENTS

--------------
Administration
--------------

#17136 : Ajout de conversions pour CAB Abstract
Ajout des conversions CAB ABSTRACT => PMBXML MARC et CAB ABSTRACT => MARCISO2709

--------
Editions
--------

#17626 : Ajout d'état des circulations
Nouvelle entrée dans la partie Editions > Périodique > Etat des circultations
Cette page permet de consulter l'ensemble des liste de circulation et de les filtrer par localisation d'abonnement, par panier de notices ou par notice de périodique.
Cette liste est exportable dans un tableur.

----
OPAC
----

#18059 : Affichages Django des autorités
Report à l'OPAC des affichages Django pour les autorités.


*******************
EVOLUTIONS

------------
Acquisitions
------------

#16868 : Sélection de budget
En commande, la recherche se fait sur les rubriques et sur les rubriques parentes.

#17066 : Tri de la liste des abonnements
Dans la fenêtre de sélection des abonnements à partir d'une commande, il est possible de trier en croissant/décroissant sur l'abonnement et sur la date d'échéance.

#17325 : Saisie d'avoirs dans les acquisitions
Possibilité de saisir des avoirs via les frais annexes, en acceptant les montants négatifs.

--------------
Administration
--------------

#17715 : Curl et nom de domaine
Possibilité d'ajouter des options à curl en administration des recherches prédéfinies, si l'url appelée est sur le même domaine que la gestion de PMB.

#17884 : Notices d'un OAI entrant
Possibilité de nettoyer le HTML contenu dans les notices d'un OAI entrant à la synchronisation.

#18846 : Module par défaut
Sélection du module par défaut de l'utilisateur via un menu déroulant et ajout du module fiches dans les modules par défaut disponibles.

#20174 : Modification de libellé en formulaire d'import de notices
Modifications de deux libellés pour plus de clarté sur le dédoublonnage éventuel.

#20399 : Factorisation du développement sur les facettes
Refonte du développement sur les facettes. 

#20400 : Facettes sur les autorités personnalisées
Possibilité de faire des facettes sur les autorités personnalisées.

---------
Autorités
---------

#19620 : Remplacement d'autorité
La case à cocher "Conserver les liens entre autorités" est cochée par défaut.

#19625 : Formulaire d'un éditeur
Affichage des collections utilisées par cet éditeur dans le formulaire.

---------
Catalogue
---------

#17259 : Paniers en accès rapide
- Ajout des paniers en accès rapide pour les autres types de paniers (exemplaires, bulletins et lecteurs).

#17648 : Champs présents lors de "l'export des destinataires" d'un abonnement
Modification des champs présents dans le tableur lors de "l'export des destinataires" d'un abonnement.
Ces champs reprennent les champs du template de la liste de circulation.

#17676 : Inscription aux listes de circulation
Création d'une alerte quand un lecteur fait une demande d'inscription ou de désinscription aux listes de circulation. Un email est également envoyé aux utilisateurs.

#17887 : Notice de bulletin
En modification de bulletin, possibilité de supprimer la notice associée.

#17897 : Forge #126 : Préremplissage de la vignette des dépouillements avec la vignette du bulletin
Ajout d'un nouveau paramètre dans le fichier serials.class.php permettant de dupliquer automatiquement l'url de la vignette de la notice de bulletin lors de la création d'un dépouillement.
Si le paramètre serial_thumbnail_url est activé et que l'url de la vignette du bulletin est vide alors c'est l'url de la notice mère qui est dupliquée à la création du dépouillement.

#18701 : Recherche créateur de la notice
Possibilité de rechercher par créateur de notice en recherche multicritères, en partie gestion.

#18703 : Recherche créateur de l'exemplaire
Possibilité de rechercher par créateur d'exemplaire en recherche multicritères, en partie gestion.

#18920 : Constitution d'étagère
Ajout des classements des paniers dans la constitution d'une étagère.

#20018 : Liste des classements d'un panier
Passage de la liste des classements existants en propriété statique de classe.

#20439 : Dupliquer un modèle prévisionnel
Reprise du nom du modèle d'origine en duplication de modèle prévisionnel.

#20740 : Droits d'accès après procédure d'action
Ajout d'un bouton permettant de recalculer les droits d'accès sur un panier après l'application d'une procédure d'action.

-----------
Circulation
-----------

#17722 : Reset d'un exemplaire
Possibiliter de conserver la section sur le reset d'un exemplaire en transfert.

#17853 : Suppression des réservations planifiées
Ajout d'une demande de confirmation sur la suppression des réservations planifiées.

#18288 : Duplication des abonnements d'un lecteur sur un autre lecteur
Possibilité de dupliquer les abonnements cochés d'un lecteur vers un autre lecteur.

#19086 : Date de début d'une réservation issue d'une prévision
Lorsque la réservation issue d'une prévision est validée, la date de début est conservée. Les informations sont reportées sur la lettre ou l'email de confirmation.

#19129 : Gestion des groupes localisés
Si les groupes sont localisés, il est possible de filtrer sur la localisation du responsable.

#20307 : Placement dans la page des relances
Après avoir effectué une action sur un emprunteur à relancer, la page se repositionne sur la même ligne après rechargement.

#20444 : Tableaux des transferts
Les déroulants de choix de localisation sont désormais triés par ordre alphabétique, les tableaux de refus et de retour possèdent des entêtes cliquables afin de trier les données.

#20529 : Ajout d'un responsable à un groupe
Possibilité d'ajouter le responsable d'un groupe à la liste des membres du groupe par une case à cocher.

------
Divers
------

#17200 : Mise à jour de la classe phpmailer
Mise à jour des classes phpmailer et smtp pour envoi de mail. Assure la compatibilité avec serveurs outlook.com

#17385 : Recherche sur les autorités persos
Ajout de plusieurs critères pour la recherche multicritères sur les autorités persos, en gestion et en OPAC, dont un sélecteur d'autorité.

#17495 : Editeur HTML TinyMCE
Prise en compte des nouvelles versions de TinyMCE, dont certaines méthodes changent au fil des versions.

#18146 : Contenu des documents numériques
Factorisation de la méthode d'accès au contenu des documents numériques

#18702 : Créateur et date de création d'un panier
En modification de panier, affichage du créateur et de la date de création.

#18785 : RMC Notices : Ajout d'opérateurs pour les critères de concepts
Ajout d'opérateurs pour les critères de concepts en recherche multicritères gestion et OPAC.

#21213 : Modification page de login
Modifications dans l'écran de connexion en gestion :
- pied de page :
à gauche : PMB 4.2.7 (changelogs.txt) - database v5.19 - © 2002~2016
à droite : www.sigb.net | forge.sigb.net
- onglet "OPAC" : ouvrir dans un nouvel onglet

---
DSI
---

#17878 : Flux RSS des veilles
Ajout de champs dans le formulaire de création des veilles permettant d'enrichir les informations du flux RSS généré.

#20179 : Veilles : rafraichissement automatique via le planificateur de tâches
Le rafraîchissement des veilles peut se paramétrer grâce au gestionnaire de tâches.
Le type de tâche "Veille automatique" a été ajouté.
Les veilles sont actualisées selon leur TTL.

--------
Editions
--------

#17928 : Templates de bannettes
Ajout de deux nouveaux motifs insérables dans les templates de bannettes, permettant d'obtenir le rendu de toutes les notices de la bannette sans passer par les sommaires s'il y a un regroupement, et permettant d'obtenir le nombre de notices dans la bannette.

#19910 : Templates de notices
Ajout d'une fonction #htmlentities(); permettant de renvoyer une chaîne en entités html.

#20293 : Ajout de paramètre sur fonction de template de notice
Les fonctions de template de notice #expl_num_vign_reduit(); #expl_num_with_tpl(); #bull_for_art_expl_num_vign_reduit(); #bull_for_art_expl_num_with_tpl(); possèdent un nouveau paramètre permettant de filtrer sur les statuts de document numérique.

----
OPAC
----

#16980 : Images substituables dans les affichages django
Il est maintenant possible d'utiliser le préfixe "img.nom_de_l_image.extension" dans les templates Django. Cela fait appel à la mécanique de substitution des images.

#16982 : Affichage django des notices : ajout d'informations dans le template 'common'
- Affichage des états des collections pour les périodiques
- Titre "Documents numériques" ajouté au dessus de l'affichage de la liste
- Classe CSS sur la case à cocher de sélection de notices dans un panier
- Autres lectures
- Recherches similaires

#17020 : Affichage django des notices : ajout d'informations dans le template 'common'
Ajout de l'URL associée dans l'affichage détaillé du template 'common'.

#17318 : Optimisation des templates django de notices
- Ajout des blocs dans les affichages étendus
- Optimisation des héritages de templates
- Ajout d'un template spécifique pour les affichages réduits de bulletins
- Ajout d'informations diverses 

#17347 : Affichage django des notices : ajout d'icônes tag et documents numériques
- Ajout d'une icône pour les documents numériques
- Changement de l'url pour l'icône des tags
- Suppression du champ "titre uniforme" s'il est vide

#17352 : Affichage personnalisé IREPS Pays de la Loire
La disponibilité des exemplaires n'est plus affiché sous les notices pour la classe d'affichage personnalisée IREPS.

#17457 : Image de la notice présente dans le panier au format png
L'image du panier au format gif est remplacée par un format png. basket_exist.png à la place de basket_exist.gif.

#17460 : Affichage django des notices : ajout d'informations dans le template 'common'
- Ajout du complément du titre
- Ajout du nombre de pages pour les articles

#17773 : Alerte email de réservation planifiée
Envoi d'un email aux utilisateurs concernés lorsqu'une réservation planifiée est créée ou supprimée par un lecteur à l'OPAC.

#17788 : Libellé "Gérer vos alertes"
Dissociation des messages "Gérer vos alertes" entre le bouton et le texte affiché dans la page.

#17915 : Tableau des alertes
Modification html pour une meilleure compatibilité responsive du tableau des alertes dans le compte lecteur.

#18057 : Liste des flux rss
Ajout d'une classe sur le tableau de la liste des flux rss

#18742 : Images substituables
Deux nouvelles images substituables via la nouvelle mécanique (#10476) :
- previous1.png
- next1.png

#18755 : Liste des concepts par schéma
Ajout de deux méhodes dans la classe skos_concepts_list de l'OPAC permettant de retrouver tous les concepts d'un schéma par libellé et par uri.

#18963 : Tri des éléments de flux rss
Prise en compte de l'année (year) et de la date de parution (date_parution) dans le paramètre OPAC flux_rss_notices_order permettant de trier les flux rss générés en DSI.

#19079 : Affichage django des notices : ajout d'informations dans le template 'common'
Champs ajoutés :
- titre parallèle
- titre uniforme
- mots-clés
- concepts
- langues de la publication
- langues originales
- nouveauté
- notices liées
- pour les notices autres que monographies, ajout du type de document à la suite du type de notice

#19281 : Balise class sur facettes
Ajout de balise class sur les tableaux de facettes

#19305 : Affichages django des notices : Réseaux sociaux
Affichage des réseaux sociaux sur les nouveaux affichages de notices.

#19416 : Images substituables
Deux nouvelles images substituables via la nouvelle mécanique (#10476) :
- home.gif
- rayonnage-small.png

#19543 : Affichages django des notices : Listes de circulation
Dans l'affichage détaillé des périodiques (template 'common'), ajout d'un bouton "Demander l'abonnement à la liste de circulation" selon les paramètres suivants :
- Autorisé au niveau de la notice
- Paramètre 'opac_serialcirc_active' activé
- Lecteur identifié + statut autorisé

#20002 : Accès aux variables de session et d'environnement depuis n'importe quel template django
Deux nouvelles fonctions lookup, contenant ces variables, ont été créées dans le fichier pmb_h2o.inc.php :
- session_varsLookup
- env_varsLookup

#20117 : Paramètre OPAC short_url
Paramètre pour afficher ou non le lien de génération d'un flux RSS de la recherche

#20207 : Classes sur affichage public
Ajout de classes sur les lignes du tableau de l'affichage public d'une notice.

#20226 : Facettes : Amélioration de l'ergonomie sans résultats
Le bloc de facettes ne sera plus affiché si aucune ne correspond à la recherche. 

#20281 : Classe sur tableau d'autorité
Ajout d'une classe sur le tableau affichant une autorité.

#20391 : Envoi par email d'un panier à l'OPAC
Possibilité de personnaliser l'objet de l'email envoyé.

#20392 : Ajout du type de relation entre les notices
Dans les templates django de notices, le code de relation est ajouté tel qu'il est défini dans les fichiers XML relationtypedown.xml et relationtypeup.xml
Ex : {{ relation.relation_type }}

#20575 : Prise en compte d'une classe spéciale dans les affichages Django de notices
Ajout de la possibilité d'ajouter une classe "spéciale" pour construire des propriétés spécifiques à l'affichage
La classe doit être dans un répertoire "special" du dossier de templates et porter le nom du dossier en préfixe..
(exemple <pmb>/opac_css/includes/templates/records/demobib/special/demobib_special.class.php)
les informations de cette classe sont accessibles dans le templates sous la propriété {{ record.special.<info> }}

#20744 : Classes sur demandes
Ajout de classes sur la liste des demandes de l'emprunteur.

#20951 : Amélioration de la gestion des fichiers dans la visionneuse
Empêcher la suppression du fichier dummy.txt du répertoire temporaire de la visionneuse.
Amélioration de la gestion des fichiers temporaire de la visionneuse Bookreader avec les serveurs windows.

-------
Portail
-------

#17390 : Portfolio : Ajout pictogramme édition de document
Un pictogramme de crayon a été ajouté à gauche du lien en partie construire.

#17738 : Surcharge de métadonnée titre
Possibilité de donner un titre personnalisé via la surcharge de métadonnées, sur les pages non gérées par défaut, via une entrée dans les fichiers de message comportant le code "cms_page_title_XXX" où XXX correspond au numéro de sous-type de page.

#19882 : Ajout de deux variables dans les templates django du portail
Deux variables ajoutées dans les templates django dans la construction du portail :  
-nom du navigateur : {{env_vars.browser}}
-nom du système d'exploitation : {{env_vars.platform}} 

#19967 : Évolution du formulaire de création de cadre dans le portail
- un champ texte permet de renseigner le nom d'une classe CSS que l'on veut attribuer à un cadre.
- ajout de javascript pour éviter de cocher "cadre fixe" quand il y a des conditions d'affichage.
- renommage de la coche "Attaché à la page ?" en "Conserver l'URL de construction ?".

#20448 : Filtre sur les cadres en construction de portail
Ajout d'un filtre dans l'interface de construction du portail pour rechercher les cadres depuis leur nom ou leur identifiant.

#20588 : Évolution de l'affichage des cadres hors de la page dans la construction du portail
En plus du nom du cadre, il y a :
- son identifiant
- son classement
- son mode de mise en cache
- sa classe CSS
- ses conditions d'affichage
- sa source de données
- sa vue
Des <span> encadrent toutes ces informations.
À l'activation du drag and drop, les cadres hors de la page apparaissent.




************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
*                                    CHANGE_LOG_4.2.7                                                                  *
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************


*******************
ANOMALIES

------------
Acquisitions
------------

#14924 : Tri alphabétique en sélection de budget
Dans la fenêtre de sélection du budget à partir d'une ligne de commande, les rubriques sont triées par ordre alphabétique.

#16605 : Statut de suggestion
Correction de l'anomalie qui affichait une erreur lors de la mise à jour du statut d'une suggestion en réception d'acquisition.

#15762 : Champ prix dans les commandes
Le champ prix dans les commandes ne permettait pas de saisir plus de 5 chiffres avant la virgule

#15990 : Montant des budgets et des frais dans les commandes
Augmentation des montants possibles de 6 à 10 chiffres avant la virgule.

--------------
Administration
--------------

#15714 : Réindexation du contenu éditorial par l'interface de PMB
La réindexation des sections n'était pas réalisée entièrement.

#13302 : Connecteur OAI sortant
Correction de l'encodage de la liste des sets pour un connecteur OAI sortant.

#13670 : Administration des recherches prédéfinies
Les fichiers xml nécessaires sont chargés, même si le répertoire temp de PMB a été vidé.

#14212 : Entrepôt et statut de notice
Prise en compte du statut par défaut en intégration de notice lors d'une synchronisation externe d'un entrepôt par le gestionnaire des tâches.

#14690 : CP Liste de choix : Nombre de choix par ligne
Prise en compte de l'option nombre de choix par ligne pour les champs personnalisés de type 'Liste de choix'. 

#15368 : Transformation xslt et connecteur OAI entrant
Application de la feuille de transformation xslt éventuellement déclarée dans un connecteur entrant OAI, pour le format PMB XML UNIMARC.

#15378 : Export des documents numériques
Correction de l'export des informations de documents numériques en PMB XML UNIMARC.

#15565 : Exécution du planificateur de tâches
Ajout de globales sur l'utilisateur utilisé par le planificateur de tâches, permettant de récupérer le statut par défaut en création d'exemplaires ainsi que le propriétaire par défaut.

#16645 : Liste des templates de mail
La liste des templates de mail est désormais triée dans l'ordre alphabétique.

---------
Autorités
---------

#14140 : Enregistrement de titre uniforme
Correction du template des titres uniformes pouvant bloquer l'enregistrement si l'éditeur javascript est activé.

#15339 : Correction d'une erreur SQL
Correction d'une erreur SQL dans la fonction d'import des Titres uniformes

---------
Catalogue
---------

#13959 : Recherche par date
Correction des critères de recherche multicritère sur la date de publication.

#13181 : Indexation des termes rejetés
Ne pas exécuter la requête d'indexation si le noeud a pour identifiant 0 en base de données.

#13233 : Sélection d'indexation décimale
Correction de l'anomalie empêchant la sélection d'une indexation décimale si celle-ci est présente dans la deuxième page du pop-up de sélection.

#13432 : Mauvais tri en multi-critères
Correction de l'application des tris dans les recherches multi-critères.

#13506 : Flèche bas dans les champs multilignes
Correction du blocage de la flèche bas, qui empêchait de se déplacer avec les flèches dans les champs de saisie multilignes.

#13955 : Recherche prédéfinie avec plusieurs autorités
Correction de l'erreur qui génére une mauvaise recherche prédéfinie si plusieurs autorités sont sélectionnées sur une recherche multicritères.

#13977 : Autorités multiples en recherche multi-critères
Correction des requêtes pour le 'et' par défaut entre plusieurs valeurs d'autorités sur un même critère de recherche multi-critères.

#14153 : Panier rapide et affichage ajax
Affichage des paniers rapides lorsque le contenu de la notice est chargé en ajax.

#14360 : Recherche connecteur PMB par ISBN
Correction de la recherche par ISBN dans un connecteur webservices PMB

#14443 : Vidage d'autorité
Correction du bouton permettant de vider une autorité en recherche multicritères, le libellé était bien effacé, mais son identifiant était conservé.

#14502 : Grille de catalogage des bulletins
Ne pas rendre possible l'affichage des champs de périodiques 'Montrer le bulletinage à l'opac'.

#15508 : Suppression d'un critère de recherche multi-critères
Correction de la recherche multi-critères avec plusieurs valeurs de type autorité car la suppression ne fonctionnait pas.

#16059 : Calcul des numéros hors série lors du bulletinage 
Correction pour prendre en compte les numéros hors série qui peuvent être ajoutés à l'abonnement.

#16729 : Correction d'erreurs à l'enregistrement d'une notice avec un ISBN et un titre uniforme à la BNF
Lors de l'enregistrement d'une notice avec un ISBN, si celle-ci est trouvée à la BNF et qu'elle a un titre uniforme alors une erreur était affichée et bloquait la fin des traitements dont l'indexation.

-----------
Circulation
-----------

#15419 : Réservations à traiter
Correction de l'affichage qui reprenait les informations de retour prévu du prêt de l'exemplaire précédent dans le tableau.

#13240 : Non-affichage des transferts
Correction de l'anomalie qui bloquait l'affichage des transferts, si un template de notice était présent et appelait la fonction aff_statut.

#13740 : Impression des listes de circulation
Correction de l'anomalie empêchant d'imprimer la liste de circulation d'une autre localisation quand les lecteurs sont localisés.

#15285 : Messages du retour secouru
Correction de l'encodage des messages affichés en cas de retour secouru.

#16414 : Prévisions de réservation
Passage de la quantité par défaut à 1 lors d'une prévision de réservation

#16625 : Correction du mail d'inscription / désinscription à un abonnement de périodique
Suppression de l'html dans les mails d'inscription / désinscription à un abonnement de périodique

--------
Demandes
--------

#14513 : Création de notice depuis une demande à l'opac
Correction de l'erreur fatale lors de la création de la notice et prise en compte du paramètre utilisateur pour l'envoi de l'alerte par email.

#14961 : Notice associée à une demande
Modification de la requête générant la notice associée, la date de création de la notice est désomais correcte.

------
Divers
------

#14268 : Accès à des propriétés privées dans les templates Django
La tentative d'accès à une propriété privée d'un objet dans un template Django ne renvoie pas d'erreur.

#14678 : Historique en base de données
Augmentation de la taille du champ des sessions en base de données.

#14834 : Correction de l'accès aux documents numériques en UTF8
Prise en compte des noms de fichiers selon l'encodage de la base de données et l'encodage du système de fichiers.

#16543 : Ascenseurs dans les popups
Ajout des barres de scroll dans les popups de sélection de fonction d'auteur, de sélection de champs de type marclist dans les oeuvres et dans la popup de visualisation de DSI.

---
DSI
---

#13402 : Veilles : Corrections
- Correction sur la récupération des dates à partir d'un flux RSS
- Lors de la synchronisation d'une veille, on supprime désormais les items supprimés de sources supprimées.
- Message 'Source supprimée' pour les items pertinents d'une source supprimée dans la liste des items.

#13443 : Statut des notices en création
Tous les statuts sont disponibles en création de notice par les veilles.

#13445 : Date de création de la notice
Prise en compte de la date du jour pour la création d'une notice depuis une veille.

#13949 : Groupement par champ personnalisé
Correction de l'erreur provoquée par le groupement d'une bannette sur un champ personnalisé, si aucune notice de la bannette n'est valorisée avec ce champ.

#14230 : Affichage des vignettes
Correction de la taille des vignettes de notices envoyées par dsi si l'url de la vignette est renseignée.

#15175 : Flux rss Atom
Correction d'une erreur dans les veilles provoquée par le flux rss atom de youtube : balises doublées avec nom d'espace.

#15211 : Catégories des items d'une veille
Correction de la récupération des catégories d'un item en création de notice.

#15799 : Encodage des mails de DSI
Correction de l'encodage des mails de DSI avec un template et un PMB en latin1.

#16662 : Flux rss Atom
Correction du cas spécifique des flux RSS Atom qui pouvait bloquer le chargement de certaines veilles.

#16803 : Balise h1 sur les produits documentaires
Suppression d'une balise h1 inutile dans les produits documentaires.

--------
Editions
--------

#13636 : Fonction de template de notice #authors_by_type_with_tpl();
Correction de l'affichage si l'auteur n'a pas de fonction.

#15983 : Correction dans les templates de notices
Correction de la fonction de parse html des templates de notice.

----
OPAC
----

#13663 : Navigateur de périodiques dans un module du portail
Dans un PMB en utf-8, lorsque l'on affiche le navigateur de périodiques de l'OPAC dans un module du portail, l'encodage des caractères des noms de périodique est désormais correctement géré.

#15483 : Encodage des flux RSS
Avec certaine configuration de serveur web les flux RSS n'étaient pas affichés dans les navigateurs

#15715 : Authentification par pop-up dans la visionneuse
Lorsqu'il faut être connecté à l'Opac pour accéder à un document numérique dans la visionneuse le pop-up d'authentification est désormais proposé.

#13263 : Affichage des documents numériques dans la visionneuse
Respect du paramètre explnum_order pour l'ordre des documents numériques.

#13277 : Visionneuse depuis un résultat de recherche multi-critères
Le navigateur dans la visionneuse ouverte depuis un résultat de recherche multi-critères parcourt uniquement les documents numériques des résultats de la recherche.

#13280 : Facettes et autopostage
Prise en compte de l'autopostage dans le filtrage par facette des notices d'une catégorie.

#13505 : Accès aux mots clés dans les templates Django de notice
Les mots clés sont accessibles dans un tableau dans les templates Django de notice.

#13514 : Classes sur état des collections
Harmonisation des classes sur le tableau des états des collections, selon que le paramètre collstate_data est valorisé ou non.

#13516 : Accès aux langues dans les templates Django de notice
Les informations de langues et langues originales de notice sont accessibles dans un tableau dans les templates Django

#13518 : Emprises dans les templates Django par défaut 
La carte des emprises est présente dans les templates Django de notices du répertoire common.
En résultat de recherche, pour que la synchronisation entre la carte et la liste de notices fonctionne, il faut que chaque notice soit contenue dans un bloc ayant pour id 'record_container_{{ record.id }}'. Pour exemple, cela est fait dans les templates du répertoire common.

#13529 : Report des critères du module de géoréférencement dans les équations de vue
Report des critères dans le fichier OPAC search_fields_gestion.xml

#13597 : Correction de l'affinage d'un résultat de recherche par la carte
Correction d'une erreur sur le changement de page de résultats de recherche et de l'application des facettes après l'affinage de ce résultat par la carte affichée au dessus.
Un manque dans le formulaire d'affinage ne permettait pas de reconstruire correctement la recherche courante.

#13669 : Template Django de notices : Troncature du résumé
La fonction limitstring est utilisée à la place de la fonction truncate pour tronquer les résumés dans les affichages courts de notices par défaut.
Ce changement évite d'éventuels problèmes d'encodage.

#13792 : Visionneuse pour les articles
Correction de l'anomalie n'affichant que les document numériques du bulletin associé à un article.

#14149 : Visionneuse sur recherches
Correction de l'affichage de la visionneuse en cas de recherche personnalisée en page d'accueil.

#14215 : Corrections diverses
- Inclusion des enrichissements sur les réservations faites via un panier.
- Erreur syntaxique sur la variable $_SESSION['id_empr_session']
- Erreur dans une requête SQL
- Header manquant

#14231 : Template Django de notice : accès simplifié aux champs personnalisés
Les champs persos de notices sont directement accessibles dans les templates Django par la variable {{ record.p_perso.[nom_du_champ] }}

#14250 : Affichage de templates django et comparateur
Prise en compte des templates django dans le comparateur de notices

#14277 : Génération d'un flux RSS à partir d'une recherche
Prise en compte des vues et des fonctions de filtre de recherche personnalisée lors de la génération et de l'affichage des notices dans le flux RSS

#14292 : Affichage des documents numériques à l'OPAC
Si lors de la création d'un document numérique lors d'import par les connecteurs ou le z39.50 il n'y a pas de statut pour celui-ci de précisé alors on applique le statut par défaut.

#14326 : Lien bannette dans le compte lecteur
Si l'affichage d'une bannette est tronqué, remplacement des points de suspension par un lien 'Voir la suite...' amenant sur le contenu de la bannette, entouré par une balise 'span'.

#14331 : Balises span pour le surlignage
Si un seul terme est cherché, correction des balises span qui provoquaient un double surlignage.

#14341 : Robots d'indexation
Exclusion des robots Qwantify et Slurp (yahoo) pour l'enregistrement des statistiques.

#14793 : Recherche tous champs et synonymie
Correction du nombre de notices retournées en recherche tous champs en cas de synonymie.

#15256 : Visionneuse et serveur windows
Correction de l'extraction de pages depuis un document pdf, sur un serveur Windows.

#15598 : Libellé des facettes
Prise en compte des messages comportant le caractère '_' pour les libellés des facettes, en lien avec l'évolution #13191.

#15878 : Affichage des alertes disponibles pour le lecteur à l'Opac
Modification pour ne pas afficher les alertes reliées à aucun groupe lecteur.

#16033 : Modification du code HTML de l'Opac
Ajout d'une balise html span avec la classe 'sort' pour encadrer l'affichage concernant le tri à l'OPAC.

#16103 : Surlignage en recherche exacte
Le surlignage en recherche exacte n'était plus fonctionnel.

#16538 : Eléments manquants dans l'affichage django common
Prise en compte des problèmes d'affichage suivants :
- virgule en trop après le titre de série si pas de numéro
- virgule en trop après l'éditeur de série si pas d'année
- affichage de l'année d'édition s'il n'y a pas d'éditeur
Prise en compte des paramètres OPAC suivants :
- allow_add_tag (uniquement côté PHP pour le moment)
Pour en tenir dans le template common :
{% if record.tag_allowed %}
  contenu HTML
{% endif %}
- avis_allow
- show_empty_items_block
- book_pics_msg
- permalink
- show_exemplaires
- show_suggest_notice (uniquement côté PHP pour le moment)
Pour en tenir dans le template common :
{% if record.sugg_allowed %}
  contenu HTML
{% endif %}

#16706 : Correction erreurs php à l'Opac
Modification pour supprimer des erreurs Php à l'Opac si le serveur est configuré pour les afficher ce qui n'est pas le cas par défaut.

-------
Portail
-------

#13407 : Modification de l'URL affichée en construction du portail
Prise en compte du paramètre opac_url_base.

#13624 : Ajout d'un hack pour gérer l'incompatibilité entre IE8 et JQuery 2
Ajout d'un Test pour n'inclure que JQuery 1.9 si le navigateur IE est équivalent ou inférieur à IE8 

#13631 : Module liste de documents numériques : Correction du mode plein écran
Ajout d'un test pour supprimer l'erreur à la mise en plein écran sur internet explorer

#14700 : Problème de suppression des filtres
Il est maintenant possible de supprimer un filtre dans un cadre sans avoir à supprimer et recréer ce dernier pour l'éliminer.

#15535 : Sélecteur de champs génériques
Charset manquant pour l'affichage dans le sélecteur du contenu des champs génériques d'articles et de rubriques.

#16405 : Liste d'étagères et vues
Prise en compte des vues dans le module de liste d'étagères du portail.

#16606 : Date de création d'article et de rubrique
Modification de l'affichage de la date de création d'article et de rubrique, au format défini dans PMB.

#16808 : Forge #116 : carrousel en fondu
Correction de la transition en fondu dans le carrousel (non responsive). La transition en fondu reste incompatible avec IE8.


*******************
EVOLUTIONS

------------
Acquisitions
------------

#16602 : Recherche de suggestion par ISBN
Modification de la recherche des suggestions par ISBN, en réception d'acquisition, afin de retrouver les ISBN mal formatés.

#15225 : Rubrique budgétaire et ligne de commande
Affichage de l'arborescence complète de la rubrique budgétaire dans une ligne de commande.

#15310 : Recherche dans les suggestions
Possibilité de filtrer sur la date de création, possibilité de filtrer par origine sur les visiteurs (recherche sur l'adresse email).

#16716 : Sélection d'abonnement en commande
Dans le formulaire de sélection d'abonnement, prise en compte du paramètre utilisateur 'Localisation par défaut en visualisation du bulletinage' pour la localisation par défaut et prise en compte du paramètre général 'abt_end_delay' pour la date d'échéance par défaut.

--------------
Administration
--------------

#13441 : Gestion des images des templates de mail
Forçage du tri alphabétique des fichiers, indépendemment de la casse.
Affichage de l'image au survol de la vignette par la souris.

#13667 : Ajout de droits d'accès sur codes statistiques lecteurs
Définition de droits d'accès en fonction des codes statistiques de lecteurs pour les droits Emprunteurs-Notices et Emprunteurs-Documents numériques.
Les paramêtres sont définis dans les fichiers 'pmb/(opac_css)/admin/acces/empr_notice/domain.xml' et 'pmb/(opac_css)admin/acces/empr_docnum/domain.xml' (en Gestion et en OPAC), mais ne sont pas activés par défaut.
Il faut créer des fichiers de substitution (domain_subst.xml) pour les activer.

#14808 : Alertes de nouvelle réservation
Ajout d'un paramètre général 'resa_alert_localized' permettant d'envoyer l'alerte mail de nouvelle réservation aux utilisateurs selon le site de gestion des lecteurs par défaut, si les réservations sont localisées.

#15313 : Ajouter un utilisateur
Ajout du bouton pour ajouter un utilisateur en haut de la liste des utilisateurs.

#15317 : Date de création d'un utilisateur
Affichage de la date de création dans la liste des utilisateurs.

#15497 : Connecteurs sortants OAI
Création d'un paramètre pour tenir compte de la date de modification des exemplaires dans un connecteur OAI sortant

#15507 : Synchronisation entrepot par planificateur
Création d'un paramètre sur la tache planifiée permettant de ne pas inscrire les notices importées dans la table notices_externes

#16043 : Amélioration du tableau de bord
Ajout d'informations sur l'exécution des tâches du gestionnaire dans le tableau de bord de l'administration.

---------
Catalogue
---------

#13634 : Etats des collections
L'affichage de l'état des collections est paramétrable, les champs personnalisés sont également affichables.
Paramètre 'collstate_data'.

#13668 : Script personnalisé de génération de code-barre en création d'exemplaire
Possibilité d'inclure une fonction dans le script personnalisé qui définit si la case à cocher 'Génération automatique' est cochée par défaut ou non.

#15075 : Modification du formulaire de la circulation de périodique
Ajout du bouton Enregistrer et continuer sur l'ajout d'un lecteur
Implémentation de la complétion Ajax des lecteurs

#16157 : Import Z3950
Ajout de deux fonctions pour personnaliser le format d'import des notices en Z3950

#16771 : Champs personnalisés en recherche multi-critères
Ajout d'un attribut hideByCustomName sur les balises fieldType des champs personnalisés, dans le fichier search_queries.xml en gestion et en opac. Cette balise permet de cacher certains champs personnalisés en recherche multi-critères, en indiquant les noms des champs personnalisés séparés par une virgule.


--------
Demandes
--------

#14658 : Demandes : afficher le nombre de demandes
Nombre de demandes affiché entre parenthèses.

#13404 : Mise à jour de dojo
Passage de la version compilée de dojo en 1.10.4.
(Solutionne le problème du Â dans l'éditeur dojo)

------
Divers
------

#13739 : Liste des valeurs d'un champ personnalisé de lecteur
Ajout d'une méhode permettant de récupérer les valeurs d'un champ personnalisé de lecteur dans les webservices.

#13914 : Ordre des champs personnalisés en recherche multi-critères
Possibilité de trier les champs personnalisés dans le sélecteur de champ des recherches multi-critères OPAC et gestion, en passant la valeur 'alpha' à l'attribut 'order' dans le fichier search_fields.xml.

#15612 : Fichiers de paramétrage par localisation
Possibilité de substituer les fichiers /pmb/includes/parameters_subst/per_localisations.xml et /pmb/includes/parameters_subst/rfid_per_localisations.xml.

#16514 : Charte des documents de l'interpreter et des external_services
Mis en place d'une charte pour la documentation de l'interpreter et des services externes.

#16709 : Modification des bases fournies avec l'installation de PMB
Modification des bases fournies avec l'installation de PMB pour une compatibilité en utf-8 et l'ajout du portail Zen.

---
DSI
---

#13406 : DSI : rendre optionnel l'affichage du message %s notice(s) envoyée(s) sur %s au total en en-tête de mailing
Le paramètre en édition de DSI 'Afficher le nombre de résultats dans le mail ' permet de rendre optionnel cet affichage en entête de mail

#13510 : Diffusion du contenu dans le mail
En création de bannette, la case à cocher 'Diffusion du contenu dans le mail' est cochée par défaut.

#13511 : Publipostage dans la bannette
Ajout des critères 'Libellé OPAC de la bannette' et 'Date de diffusion' dans le sélecteur de critères à ajouter.

----
OPAC
----

#13191 : Prise en charge des messages dans les libellés de facette
Il est maintenant possible d'utiliser la notation msg: dans les libellés de facette

#13499 : Images de pagination substituables
En lien avec la demande #10476.
Images :
first-grey.gif - prev-grey.gif - next-grey.gif - last-grey.gif
first.gif - prev.gif - next.gif - last.gif

#13675 : Icone 'Nouveauté'
Affichage d'une icone nouveauté dans l'entête des notices si le champ est à oui en gestion.

#14265 : Fiche lecteur à l'OPAC
Ajout de balises 'class' sur le tableau de la fiche lecteur, onglet 'Mon compte'.

#14298 : Prévisions sur le contenu d'un panier
Ajout de la possibilité de faire des prévisions sur les notices d'un panier

#14612 : Images substituables
Trois nouvelles images substituables via la nouvelle mécanique (#10476) :
- cross.png
- b_edit.png
- email_go.png

#14693 : Appliquer par défaut le bon type de tri (num/text)
Type de tri (numérique / alphanumérique) adapté selon le critère sélectionné dans la fenêtre des tris.

#14769 : Sélecteur d'accès rapide sur paramètre
Paramètre d'activation pour l'affichage du sélecteur d'accès rapide au compte lecteur OPAC.
Nom du paramètre : quick_access dans la section OPAC. Sélecteur affiché par défaut. 
Pour revenir à l'ancien affichage, il faut modifier le paramètre.
+ Ajout de nouvelles entrées dans le sélecteur :
=> Mes alertes
=> Mes suggestions
=> Mes listes de lecture
=> Mes demandes de numérisation (disponible en 4.3)

#15202 : Classe sur fenêtre d'options d'impression
Ajout de la classe 'popup' sur la balise 'body' de la fenêtre des options d'impression d'un panier.

#15213 : Classe sur recherche par terme
Ajout de la classe 'searchTerm' sur la balise body des deux iframes liées à la recherche par terme.

#16386 : Bloc de connexion
Ajout d'une classe sur la balise <h3> du bloc de connexion, ainsi que sur la balise <b> de l'emprunteur identifié.

#15728 : Affichage du menu de suggestion
Ajout d'une div id='facette_suggest' et de la classe facette_suggest pour le menu des suggestions afin de pouvoir modifier le style.

#16183 : Ajout d'une balise html en recherche multi-critères.
Ajout d'une balise html span pour les valeurs des champs personnalisés en recherche multi-critères.

#16374 : Modification html pour une meilleure compatibilité responsive
Modification html pour une meilleure compatibilité responsive du tableau des réservations dans le compte lecteur.

#16639 : Pouvoir cliquer sur l'onglet de recherche courant en Opac
Amélioration pour pouvoir cliquer sur l'onglet de recherche courant en Opac.

-------
Portail
-------

#13195 : Ajout dans les préférences utilisateur statut et type de contenu éditorial
Ajout dans les préférences utilisateur:
- statut de publication d'article par défaut en création d'article.
- type de contenu par défaut en création d'article
- type de contenu par défaut en création de rubrique

#13401 : Ajout du sélecteur depuis un permalink dans le module métadonnées d'une notice
Dans le module métadonnées, pour la source notice, ajout dans le sélecteur pour la source de donnée du Sélecteur depuis un permalink.

#13408 :  Ajout des infos de l'emprunteur dans les templates django
On a désormais accès aux informations de l'emprunteur dans les templates django des cadres de portail : nom, prénom, mail, login, adresse, etc.

#13409 : Affichage de l'id dans la liste des versions
Dans le tableau de la liste des versions du portail, on affiche désormais l'identifiant.

#13497 : Vider le cache
Création du bouton 'Vider le cache' dans la partie construire du portail. Celui-ci n'apparait que quand du cache a été calculé.

#14610 : Evolutions du module 'recherche'
- Possibilité de choisir une vue cible pour les recherches simples et avancées.
- Nouveau bloc de 'Paramétrage avancé' pour l'ajout de liens supplémentaires.

#14616 : Bouton de purge CSS
Nouveau bouton 'Purger toutes les CSS'  situé en en bas du volet 'Objets définis' de l'onglet 'Contenu' dans la construction du portail.
Condition d'affichage :
- Dernière version du portail.
Celui-ci va enregistrer une nouvelle version et initialiser à vide les valeurs du champ build_css de la table cms_build pour la dernière version créée. Cela permet de revenir sur la version antérieure si cela ne convient pas.

#15206 : Templates django par défaut
Evolution des templates django par défaut pour les modules 'veille documentaire', 'liste d'items' (vue django et vue django par tag), 'item'. Merci à Françoise Goossens pour sa participation à l'enrichissement de ces templates.
Gestion de l'utf-8 pour les templates avec caractères accentués.

#15426 : Ajout de la fonction length dans les templates Django
La fonction length est maintenant disponible en 4.2 dans les templates Django.
Elle renvoie la taille du tableau ou de la chaine passé en argument.




************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
*                                    CHANGE_LOG_4.2.6                                                                  *
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************


*******************
ANOMALIES

------------
Acquisitions
------------

#12373 : Catalogage des suggestions importées
Correction de l'erreur qui ne cataloguait que la première des suggestions importées.

---------
Catalogue
---------

#12838 : Vignette document numérique
Correction de l'anomalie qui ne générait pas la vignette pour les documents numériques de type PDF en ligne.

#12800 : Vignette des étagères
Correction de l'anomalie qui n'affichait pas l'url de la vignette de l'étagère.

#13031 : Impression d'un panier
Correction du tri du panier à l'impression.

#13044 : Thésaurus par défaut en catalogage
Non-mémorisation du thésaurus en cours sur les champs personnalisés d'autorité basés sur les catégories.

#13154 : Export des documents numériques
Correction de l'export des documents numériques depuis un panier, si ces derniers ne sont pas stockés en base.

------
Divers
------

#12326 : Tri des notices par auteurs
Correction de la méthode de tri des notices sur le critère auteur, en gestion et OPAC.

#12310 : Optimisation de requêtes en gestion
Optimisation / Correction de requêtes en gestion dans PMB

#12693 : Compatibilité avec les serveurs Web
Amélioration de la compatibilité de PMB avec d'autres serveurs Web qu'Apache.

#12799 : Champs persos de type date répétable
Quand on ajoute des champs persos répétables de type date, le calendrier présent dans le popup n'est plus vide.

#13081 : Fichier XML des quotas
Correction de la traduction par erreur des noms de table dans le fichier XML des quotas

#13110 : Application du statut par défaut à l'enregistrement d'un document numérique
Si lors de l'enregistrement d'un document numérique il n'y a pas de statut de précisé alors on applique le statut par défaut.

---
DSI
---

#11112 : Arborescence des veilles
L'arborescence des veilles ne se replie plus automatiquement. Pour constater la correction il faut vider le cache du navigateur.

#12497 : Duplication de bannette
Quand on duplique une bannette, le template de notices pour l'email et les groupements par facettes sont désormais bien repris.

#13032 : Rang d'un critère de groupement
Correction des rangs des critères de groupement avec l'utilisation d'un template de bannette.

--------
Editions
--------

#12538 : URL absolues dans les fonctions de templates
Prise en compte du paramètre pmb_opac_url pour la construction des liens vers les images et documents numériques dans les fonctions aff_gen_plus et aff_expl_num_vign_reduit.

#12387 : Affichage des catégories en template de notice
Correction des fonctions #categories et #categories_with_tpl afin de prendre en compte plusieurs thésaurus.

#12994 : Enregistrement de template de bannette
Correction de l'anomalie empêchant d'enregistrer un template de bannette si une apostrophe est présente dans celui-ci.

----
OPAC
----

#12361 : Recherche personnalisée IRTS Bretagne
Modification de la requête de filtrage sur les localisations afin de ressortir également les notices de bulletins pour les exemplaires de la localisation sélectionnée.

#12253 : Tri des étagères
Le tri défini en gestion pour l'affichage d'une étagère est conservé en session.

#12530 : Statistiques sur le navigateur de périodiques
Les consultations des notices de périodiques dans le navigateur de périodiques sont ajoutées dans les statistiques.

#12855 : Amélioration pour les Opac inclus dans une maquette
Les fonctions dojos et le dépliage des notices n'étaient pas fonctionnels lorsque qu'il s'agissait d'un Opac inclus.

#12905 : Libellé thes_libelle en recherche multicritères
Ajout d'un span sur le libellé thes_libelle en multicritères

#12978 : Affichage du mois de mai dans les templates Django
Le mois de mai s'affiche correctement en format long et court dans les templates Django.

#13006 : Statut de visibilité des documents numériques à l'OPAC
Le statut de visibilité des documents numériques défini sur la notice prévaut sur le statut de visibilité défini sur le document numérique.
Le paramètre OPAC 'show_links_invisible_docnums' rend visibles les vignettes quel que soit ce statut.

#13076 : Affichage de la page d'inscription
Correction d'une erreur à l'affichage de la page d'inscription en ligne.

#13087 : Affichage des facettes en OPAC
Correction d'une erreur lors de l'appel de ajax.php.

#13135 : Facettes
Ajout des facettes sur les étagères et le navigateur de sections.

-------
Portail
-------

#12260 : Bouton 'Vider le cache'
Le bouton permettant de vider le cache apparait lorsqu'on a modifié un champ personnalisé d'un artice ou d'une rubrique, même si l'article ou la rubrique n'a pas été modifié.

#13013 : Lien des veilles
Correction du lien du flux RSS des veilles.

#13042 : Flux RSS d'une veille
Tri des items du flux RSS des veilles par date de publication décroissante.


*******************
EVOLUTIONS

--------------
Administration
--------------

#12786 : Vérificateur de liens
Certaines url sont correctes mais le serveur ne renvoie pas d'entête. Dans ce cas, un message 'A vérifier manuellement' est affiché.

#13094 : Préférences utilisateurs : Renseigner un entrepôt des notices supprimées par défaut
Nouveau paramètre dans les préférences utilisateurs pour choisir un entrepôt de destination par défaut en suppression de notices d'un panier.

---------
Catalogue
---------

#12287 : Notice de bulletin
Création d'une case à cocher en création de bulletin et en bulletinage, permettant de créer une notice de bulletin.

#12734 : Navigation dans les pages
Ajout des liens 'première' et 'dernière' page dans les résultats de recherche simple et multicritères, si l'étendue le permet.

#12792 : Vider un panier après une réindexation du panier
Suite à la réindexation d'un panier, apparition du bouton vider le panier.

#12901 : Ordre des catégories en modification de notice
Si le paramètre categories_affichage_ordre est défini sur ordre alphabétique, les catégories sont également triées par ordre alphabétique en modification de notice.

#12931 : Vérification des url de vignette des notices
Ajout du vérificateur de liens sur les url de vignette des notices, ainsi que dans le module de vérification des liens en administration.

#12956 : Lien vers les autorités persos dans l'ISBD d'une notice
Lien vers les autorités persos dans l'ISBD d'une notice

-----------
Circulation
-----------

#12898 : Retour des périodiques en circulation
Possibilité de retourner plusieurs périodiques en circulation par sélection en cases à cocher.

------
Divers
------

#12542 : Amélioration de la gestion des automates de prêt 3M
Amélioration de PMB pour la prise en charge des nouveaux automates 3M.

#12513 : Recherche par géoréférencement
En recherche multi-critères gestion et OPAC, possibilité de rechercher les notices géoréférencées ou non ainsi que les notices indexées avec des catégories géoréférencées ou non, via les opérateurs 'Est vide' et 'N'est pas vide' sur le critère 'Emprise'.

---
DSI
---

#12999 : Recherche de bannette
Après enregistrement d'une bannette, filtrage de la liste des bannettes sur cette dernière créée.

#12908 : Définition des TTL des veilles
Clarification des deux libellés TTL dans la définition d'une veille et dans la définition d'une source de veille.

----
OPAC
----

#11243 : Affichage django des notices / fonctions pour les documents numériques
Accès aux informations de documents numériques dans les templates django.
Prise en compte des statuts de visibilité et du paramétrage de la visionneuse.

#12357 : Sélecteur de tri
Si le tri par défaut possède un libellé, les critères ne sont pas affichés dans le sélecteur.

#12742 : Permettre de désactiver la barre d'acceptation des cookies
Nouveau paramètre OPAC cookies_consent. Sa valeur par défaut est 1 (actif). 

-------
Portail
-------

#12509 : Date de modification du contenu éditorial
Dans les cadres du portail affichant des articles ou des rubriques, il est possible d'afficher la date de dernière modification de ceux-ci.

#12610 : Audit sur le contenu éditorial
Ajout d'un bouton historique sur les articles et les rubriques.

#13134 : Tri des CP du contenu éditorial (provisoire : ordre alpha)
Tri alphabétique des champs personnalisés du contenu éditorial en affichage.





************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
*                                    CHANGE_LOG_4.2.5                                                                  *
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************


*******************
ANOMALIES

-----------
Circulation
-----------

#12134 : Lien vers les éditions dans les réservations
A partir du menu 'réservations en cours', le lien qui amène vers les éditions est renommé en 'Editions : en cours', ajout d'un lien nommé 'Editions : à traiter'.

------
Divers
------

#12223 : Erreur sur mise à jour
Correction d'une erreur lors de la création d'une table selon la configuration de mysql.

--------
Editions
--------

#12102 : Fonction #group(); des templates de notices
Correction de l'affichage : si le nombre de notices demandées est supérieur au nombre de notices liées, il n'y a plus de lignes vides.

#12117 : Listes de prêts
Conservation de la localisation sélectionnée lors de la navigation entre les différentes pages.

#12135 : Export tableur des transferts
Modification des cellules exportées pour un affichage identique au tableau des éditions.

----
OPAC
----

#12201 : Navigation dans les indexations décimales
Correction de l'affichage django s'il existe des indexations filles.

#12219 : Zotero en affichage django
Correction de l'affichage django pour prendre en compte les coins zotero


*******************
EVOLUTIONS

---------
Catalogue
---------

#11978 : Bouton pour créer un panier
Ajout du bouton pour créer un panier en haut de la pop-up s'ouvrant lors d'une mise en panier de plusieurs notices

#12125 : Historique des recherches
Le tri en cours est conservé lorsqu'on appelle une recherche de l'historique en gestion.

-----------
Circulation
-----------

#12123 : Recherche avancée sur les emprunteurs
Ajout d'un opérateur 'est vide' sur le critère nombre de prêts pour retrouver les emprunteurs sans prêt en cours.

--------
Editions
--------

#12184 : Filtre dans les éditions des prêts
Ajout d'un filtre 'Localisation des exemplaires' dans les prêts en cours, retards par lecteur et retards par date.

----
OPAC
----

#11974 : Export des prêts précédents
Il est possible d'exporter les prêts précédents en tableur dans le compte lecteur.

#12155 : Titre des documents numériques
Ajout d'une balise span avec l'attribut class='title_docnum' afin de pouvoir styler le titre des documents numériques.

-------
Portail
-------

#12076 : Associations du portfolio
Ajout d'un bouton permettant de tout cocher/décocher dans les associations du portfolio.

#12094 : Enregistrement d'un contenu éditorial
Ajout d'un message confirmant l'enregistrement d'un article ou d'une rubrique.




************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
*                                    CHANGE_LOG_4.2.4                                                                  *
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************


*******************
ANOMALIES

---------
Autorités
---------

#11914 : Choix d'une catégorie parente
Résolution d'une erreur javascript sur la sélection d'un parent en création de catégorie.

---------
Catalogue
---------

#11912 : Création du document numérique en bulletinage
La saisie d'une url de document numérique est dorénavant bien prise en compte et crée le document numérique associé au bulletin.

--------
Editions
--------

#11931 : Lettres de retard
Les lettres de retard par groupe s'impriment avec la même taille de police que les lettres de retard individuelles.

----
OPAC
----

#11929 : Ajout au panier d'un résultat de recherche multi-critères
Le résultat complet de la recherche est mis au panier, pas seulement la première page.

#12004 : Champ personnalisé d'exemplaire
Correction de l'affichage du tableau des exemplaires si un champ personnalisé est visible à l'OPAC.

#12050 : Affichage de l'aide
Correction d'une erreur lors de l'affichage de l'aide.

-------
Portail
-------

#11900 : Correction Page not Found dans la construction du portail
Correction d'un cas particulier du rechargement de l'OPAC en construction de portail après l'enregistrement d'un cadre sur la page index.php

#11928 : Sélecteur par champ générique d'article ou de rubrique
Correction d'une erreur d'affichage à la sélection de la source de données.


*******************
EVOLUTIONS

--------------
Administration
--------------

#12019 : Localisation par défaut en bulletinage
Ajout d'un paramètre utilisateur permettant de sélectionner la localisation par défaut en bulletinage

---------
Catalogue
---------

#12016 : Déplacement d'un dépouillement
En modification de dépouillement, un bouton permet de déplacer celui-ci vers un autre bulletin de périodique.

------
Divers
------

#11916 : Indexation des termes rejetés
Les notices sont indexées avec les termes rejetés des catégories.

#11970 : Vider un panier après une procédure d'action
Après une action par procédure sur un panier (en circulation et catalogue), un bouton propose d'accéder au vidage du panier avec pré-sélection des éléments pointés ou non telle qu'elle a été effectuée pour l'action.

--------
Editions
--------

#11963 : Fonction #group(); pour les templates de notices
Ajout d'un quatrième paramètre : texte à ajouter si le tableau de notices liées est plus grand que le nombre de notices à afficher

----
OPAC
----

#11894 : Tableau de résultat du comparateur
La valeur 0 n'est plus affichée pour une meilleure lisibilité du tableau.

#11951 : Onglets tags, avis et suggestion des notices
Les onglets tags, avis et suggestion sont désormais dans des balises <li> séparées avec leur propre classe.

#11971 : Notation des avis
Les avis peuvent être notés avec une sélection par étoiles, les paramètres existants pmb_avis_note_display_mode et opac_avis_note_display_mode sont complétés avec deux possibilités supplémentaires.




************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
*                                    CHANGE_LOG_4.2.3                                                                  *
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************


*******************
ANOMALIES

---------
Catalogue
---------

#11686 : Vérification de l'url associée en catalogage
Un timeout est appliqué sur la vérification de l'url associée, la durée de ce timeout est modifiable en Administration / Outils / Vérificateur de liens.

-----------
Circulation
-----------

#11589 : Départ d'un exemplaire en transfert
Changement du libellé 'Retour d'un exemplaire' en 'Départ d'un exemplaire'

------
Divers
------

#11651 : Impression pdf
Mise à jour de la classe html2pdf de la version 4.03 à 4.04

--------
Editions
--------

#11594 : Circulation simplifiée des périodiques
Correction du non-affichage des différents formats d'étiquettes de circulation en utf-8.

#11709 : Templates de notices : informations d'exemplaires
Ajout du prix de l'exemplaire dans les informations accessibles.

----
OPAC
----

#11444 : Indexation du numéro dans la collection
Le numéro dans la collection est dorénavant indexé.

#11573 : Affichage des avis
Ajout de deux classes pour styler le nombre d'avis et la note de l'avis.

#11601 : Dans le pop-up de réservation et d'impression d'un panier à l'Opac le style de la vue n'est pas pris en compte
Dans les pop-ups à l'Opac si l'on a des vues avec des styles différents ce n'était pas le bon style qui était utilisé.

#11622 : Destruction de l'environnement de construction de portail
Prise en compte de la valeur -1 pour le paramètre GET cms_build_activate.
Cela provoque la destruction de l'environnement de construction.

#11649 : Mauvais affichage du comparateur
Correction de l'affichage erroné du comparateur quand l'installation est en utf-8.

#11758 : Connexion emprunteur pour les suggestions
Ajout d'un div avec une classe autour des éléments du formulaire.

#11774 : Etats des collections
Correction de l'affichage des états des collections lorsque le paramètre opac_collstate_data est activé.

#11780 : Message 'Aucun prêt en cours'.
Ajout d'une balise span sur le message.

-------
Portail
-------

#11683 : Recherche * dans le contenu éditorial
La recherche * sur le contenu éditorial fait ressortir toutes les rubriques et tous les articles.


*******************
EVOLUTIONS

------------
Acquisitions
------------

#11745 : Sélecteur de notices dans les commandes
Ajout de l'indexation décimale dans l'affichage déplié de la notice.

------
Divers
------

#11553 : Champ personnalisé de type date
La valeur par défaut en recherche (gestion et opac) n'est plus la date du jour, mais le message 'format_date_input_placeholder' des fichiers de message.

#11721 : Adresse alternative d'envoi des emails
Ajout d'un paramètre général et d'un paramètre OPAC intitulé mail_adresse_from permettant de définir une adresse alternative d'envoi des emails.

----
OPAC
----

#11540 : Image du panier au format png
L'image du panier au format gif est remplacée par un format png.

#11674 : Templates Django : documents numériques
Ajout de la fonction display_bull_for_art_expl_num pour afficher les documents numériques du bulletin parent de la notice d'article affichée.

#11737 : Prolongation d'un prêt avec un niveau de relance validé.
Ajout du paramètre opac_pret_prolongation_blocage permettant de bloquer la prolongation d'un prêt par l'emprunteur si un niveau de relance est validé.

#11785 : Bouton pour exporter les prêts dans un tableur sur le compte emprunteur
Création du paramètre opac_empr_export_loans permettant d'afficher ou non ce bouton, et modification du libellé du bouton.

#11790 : Images substituables
Trois nouvelles images substituables via la nouvelle mécanique (#10476) :
- group_by.png
- group_by_grey.png
- quest.png

-------
Portail
-------

#11656 : Contenu éditorial : retour en haut de page au clic sur une rubrique ou un article
Dans le contenu éditorial, la page s'aligne avec le sommet du formulaire d'édition de la rubrique ou de l'article sélectionné.

#11710 : Template Django dans les cadres HTML de portail
Ajout de la gestion des templates Django dans les cadres de portail de type Code HTML.

#11733 : Informations de rubrique parente dans une liste de rubriques
Les informations de rubrique parente sont disponibles dans les modules liste de rubriques ET rubrique.




************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
*                                    CHANGE_LOG_4.2.2                                                                  *
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************


*******************
ACTIONS

------
Divers
------

#11216 : Mise à jour de la documentation livrée avec PMB
Mise à jour des fichiers du dossier pmb/doc


*******************
ANOMALIES

--------------
Administration
--------------

#10029 : Page blanche en pointage des importés
Correction de l'inclusion des fichiers de calcul d'ISBN.

#10240 : L'action d'encodage des mots de passe lecteurs ne traite pas tous les lecteurs
L'action 'Encoder les mots de passe lecteurs pour la connexion à l'Opac' dans 'Administration > Outils > Nettoyage de base'  ne traitait pas tous les lecteurs de la base.

#10508 : Taille de champs en base de données
Augmentation des champs blob en mediumblob : empr_expl (table logopac), empr_expl (table statopac) et session (table opac_sessions)

#10510 : Nettoyage de base : auteurs
Correction de la fonction d'effacement des auteurs inutilisés qui provoquait un blocage.

#10563 : Import fichiers Prisme
Rendre possible l'import d'un fichier txt Prisme dans un PMB en utf-8

#10675 : Encodage des mots de passe lecteurs
Correction d'une boucle infinie sur l'encodage des mots de passe en nettoyage de base dans certains cas de synchronisation externe.

#10679 : Planificateur : blocage selon la configuration
Correction de l'erreur si le paramètre z39.50 import_modele est à 'func_other_customfields.inc.php'

#10925 : Sauvegarde : prise en compte des champs de type geometry
Correction de la sauvegarde des champs de type geometry qui bloquaient la restauration.

#11275 : Mise à jour du schéma de la base de données
Mise à jour du schéma de la base de données dans la version 5.19

---------
Autorités
---------

#10677 : Affichage des autorités liées
Correction de l'affichage ISBD des éditeurs.

---------
Catalogue
---------

#10117 : Vérification de l'url associée bloque la page
Passage du script en asynchrone.

#10130 : Ne pas modifier la date de mise à jour des notices lors du calcul des nouveautés
Lorsque que l'on enlève une notice des nouveautés, sa date de modification ne doit pas être modifiée.

#10302 : Affichage champ personnalisé de type sélecteur d'autorité
Correction de l'affichage du champ pour les notices dépliables.

#10317 : Notices nouveautés
Affichage de l'icone 'Nouveautés' pour les notices

#10415 : Indexation catégories et champ personnalisé d'autorité catégorie
Ne pas stocker en session le dernier thésaurus utilisé quand l'appel se fait sur un champ personnalisé d'autorité catégorie.

#10678 : Envoi de recherche et documents numériques
Pouvoir envoyer les documents numériques sans les exemplaires.

#11281 : Actions rapides sur les paniers
Relooking du sélecteur d'action rapide sur les paniers

#11321 : Grille de catalogage et  ordinateurs Apple
La combinaison ctrl+clic étant transformée en clic droit sur les ordinateurs Apple, ajout de la possibilité de faire cmd(anciennement pomme)+clic pour le même résultat.

#9851 : Recherche multi-critères sur date de publication
Correction des requêtes erronées sur la recherche par date de publication, pour les critères <, <=, > et >=.

-----------
Circulation
-----------

#10263 : Transferts : retour de prêt suite à une réservation
En retour de prêt, l'exemplaire est retournable immédiatement dans sa localisation d'origine si le transfert fait suite à une réservation.

#10348 : Filtres relances
Retour du filtre sur les catégories qui n'apparaissait plus.

#10353 : Relances : changement de libellé pour la colonne 'Lettre imprimée'
Libellé changé à 'Lettre imprimée / Mail' pour les libellés français et 'Printed letters / Mails' pour les libellés anglais.

#10368 : Problème avec la suppression par panier des lecteurs qui ont une réservation validée
Blocage de la suppression si le lecteur possède une réservation validée.

#10790 : Mise en panier d'emprunteurs
Indication du nombre d'emprunteurs ajoutés dans un panier.

#10915 : Erreur sur le prêt autonome à l'OPAC
Reprise de la fonction d'origine self_checkout.
Création d'une fonction spécifique pour bibloto.
Mise à jour du manifest.

--------
Demandes
--------

#10717 :  Dans le module demande les champs personnalisés de type requete SQL ne sont pas cherchables
Le sélecteur d'un champ personnalisé de type 'Liste de choix à partir d'une requête' était vide.

------
Divers
------

#10078 : Curl : options et proxy
Possibilité de créer des tableaux d'options curl et de domaines où l'on ne doit pas utiliser le proxy. Tableaux à créer dans config_local.inc.php (gestion + opac)

#10513 : Restauration d'une sauvegarde
Correction du problème de restauration des données en base par la procédure emergency.

#10687 : Inclusion d'un fichier d'image inexistant
En gestion le fichier notification_empty.png n'est pas présent dans tous les styles mais il est dans le dossier images. 

#9967 : Echec du gestionnaire des tâches + Import en double des champs personnalisés (Z39.50 et Connecteurs)
Avec certains couples de fonctions d'import (paramètre import_modele dans 'Paramètres généraux' et 'Options z39.50') le planificateur des tâches n'était pas fonctionnel.
Lors d'un import de notices (par les connecteurs ou le z39.50) et en passant par le formulaire, des champs personnalisés étaient parfois importés en double.

---
DSI
---

#10020 : Veille : création d'article, de notice ou de rubrique
Correction des liens vers les articles et les rubriques. Mise à jour du libellé du bouton après création d'article, de notice ou de rubrique.

#10103 : Veille : lien vers les notices externes
Correction du lien pour voir les notices externes

#10184 : Modification équation de recherche en erreur si apostrophe dans le commentaire
Correction de l'objet envoyé à la requête de mise à jour.

--------
Editions
--------

#10190 : Templates : correction de la fonction #expl_num_vign_reduit(); pour les notices de bulletin
Correction de la fonction de template pour prendre en compte les notices de bulletin.

#10530 : Documentation des fonctions de consolidation
Mise à jour des fonctions manquantes dans la documentation.

------
Fiches
------

#10693 : Les fiches ne sont plus affichées
Dans le module 'Fiches', les fiches n'étaient plus affichées.

----
OPAC
----

#10077 : Filtre 'Abonnement actif' dans le navigateur de périodique
Correction de la page blanche et de l'erreur javascript si pas d'abonnement actif.

#10220 : Ajout de notices triées au panier
Prise en compte du tri effectif pour l'ajout de notices dans un panier

#10313 : Recherche par fréquence d'apparition
Correction des requêtes affichant la liste des résultats.

#10321 : Div aut_details
Ajout d'une classe sur l'affichage des div 'id_details' liés à une bannette.

#10360 : Navigateur de périodique : sélection du bon périodique
Correction d'une erreur javascript dans le cas de l'affichage des notices au format Django

#10375 : Répertoire temp de la visionneuse
Le répertoire temp de la visionneuse a été supprimé par erreur du CVS le 03/06/15 dans la version de DEV.
Le problème se retrouve aujourd'hui en 4.2 et en 4.3 DEV 

#10387 : Ajout des attributs ALT et TITLE sur la vignette de la notice
On affiche le titre de la notice dans la balise title, si celle-ci est vide.
On affiche 'vignette' dans la balise alt.

#10411 : Photothèque : notice dans le panier
Affichage de la bonne icone de panier si la notice est déjà présente.

#10414 : Lenteurs suggestions
Limitation des suggestions aux 5 premiers mots recherchés

#10527 : Modification d'un classe d'affichage personnalisée
Suppression de l'affichage des notes de contenu dans la classe abiodoc

#10548 : Visionneuse des documents numériques de type URL
Correction du non-affichage de certains documents de type URL

#10554 : Avis bbcode
Ajout d'un bouton pour écrire en rouge
Ajout d'un bouton de liste à puce

#10621 : Rang de réservation non affiché à l'Opac
Lorsque l'on réserve une notice à l'Opac dans la fenêtre de prise en compte de la réservation le rang n'était plus affiché.

#10822 : Ajout d'attribut class
Classes ajoutées sur les H3 en historique de recherche et en affichage de panier.

#10873 : Fatal error affichage Django + droit d'accès
Fatal error générée avec le nouvel affichage des notices en activant les droits d'accès sur les documents numériques

#10899 : Tableau des prêts à l'opac
Correction du colspan selon le paramétrage.

#11070 : Impression documents numériques
Ne pas proposer l'impression des documents avec un statut spécifique.

#11146 : Ajout de span pour l'application de la css
Modification des fichiers liés à l'affichage des autorités à l'Opac pour ajouter des span autours des espaces et du titre des pages.

#11283 : Authentification par pop-up
Dysfonctionnement des cookies réglé.

#11323 : Suppression de div vides
Suppression du div facettes dans la pages de section et de localisation, et suppression du div lvl1 dans les pages d'autorité.

#11340 : Import de notice dans zotero
La série était affectée en collection (Zotero), elle est désormais concaténée au titre, comme dans l'affichage ISBD.
La collection est affectée en collection (Zotero).
La mention d'édition est affectée à l'édition (Zotero).
Le permalink était affecté à l'URL (Zotero), il est remplacé par l'url associée.

#11368 : Facettes dans les pages autorités
Correction pour le comparateur et le filtrage multiple par facettes dans les pages d'autorités

#11451 : Erreur javascript sur pop-up d'aide des facettes
Le pop-up d'aide des facettes n'apparaissait que sur une comparaison active, il est désormais disponible avant comparaison.

#9855 : Dépliage impossible des notices sous Internet Explorer
Résolution d'une erreur javascript bloquant le dépliage des notices sous Internet Explorer

#9864 : Correction sur le paramètre OPAC empr_code_info
Le code HTML du paramètre empr_code_info ne s'affiche que si l'emprunteur est correctement identifié.

-------
PORTAIL
-------

#10438 : Carrousel : temps de transition
Correction de la prise en compte du temps de transition.

#10456 : Carrousel Responsive : Erreur à la mise en cache 
Correction d'une erreur JS apparaissant à l'affichage une fois mis en cache. 

#11131 : Module liste de bannettes / construction du lien vers une bannette/une notice
- La construction du lien vers une bannette n'était pas exploitée par Django.
- Erreur dans la construction du lien vers la notice

#9854 : Démarrage automatique du carrousel responsive
Ajout du paramètre 'Transition automatique' permettant le démarrage du carrousel responsive.

#9859 : Modules veille documentaire : correction de la fonction rss_link
Suppression du double slash dans l'url rss de la veille documentaire


*******************
DEVELOPPEMENTS

--------------
Administration
--------------

#10384 : Gestion des suppressions OAI
Gestion des suppressions pour les connecteurs OAI entrants.
Lors de l'import automatique des notices, suppression des notices liées aux enregistrements marqués comme supprimés sur le serveur.

---------
Catalogue
---------

#11224 : Nouvelle class de mappage des metas données
Ajout d'une nouvelle classe intermédiaire de mappage des métadonnées issues d'un dépôt WebDav et les champs de la notice associée.
Un nouveau champ dans le paramétrage d'un connecteur WebDav permet d'associer une classe spécifique à un dépôt.
Les classes spécifiques doivent héritées cette classe et être déposées dans le répertoire <pmb>/classes/webdav_mapper

------
Divers
------

#10920 : Champs perso date répétables
Rendre les champs perso de type date répétables

#10921 : Champ perso texte i18n
Création d'un champ perso répétable de type texte avec gestion de la langue

--------
Editions
--------

#10152 : Circulation simplifiée des périodiques
La circulation simplifiée des périodiques permet de ne pas bulletiner des exemplaires qui doivent partir en circulation.
Pour l'activer, il faut cocher 'Type de la circulation Simplifiée' dans la gestion des abonnements.
En Edition / Circulation Simplifiée, il y a deux formulaires:

1)Impression des étiquettes de circulation
Toutes les étiquettes de circulation des bulletins à recevoir entre deux dates sont imprimées.
Le script d'impression /includes/simple_circ/custom_label_no_script.inc.php propose 2 formats d'étiquette (2*7 et 3*7)
Il est personnalisable avec le paramètre serialcirc_simple_print_script
Pour les étiquettes possédant plus d'un groupe de circulation, un codebarres est généré.

2)Impression des listes de circulation
les codebarres générés permettent d'imprimer des listes de destinataire complètes.
Il suffit de les doucheter et d'accumuler les circulations. 
l'impression se fait en PDF personalisable aussi.

----
OPAC
----

#10472 : Affichage Django dans les modes d'affichage des résultats de recherche
Ajout du mode d'affichage Django pour les affichages multiples en résultat de recherche

#10696 : Possibilité de désactiver la pagination dans les résultats de recherche
Possibilité d'afficher tous les résultats de la recherche sur la même page.
Ajout d'un paramètre pour définir un maximum de notices à afficher sur une même page.

#10697 : Gestion des catégories dans l'affichage Django des notices
Possibilité d'afficher les catégories dans les templates django de notices.
Ajout de la classe authorities_collection afin de n'instancier qu'une seule fois les autorités qui apparaissent plusieurs fois dans la page.

#10816 : Fonction de template django pour l'affichage des mois en format court
Ajout d'une fonction django pour l'affichage des mois en format court (jan, fev, mars, avr...).
Nom de la fonction : shortmonthletter

-------
Portail
-------

#10525 : Module liste de catégories
Développement d'un module permettant de lister les formes retenues matchant la recherche via la forme rejetée.

#10619 : Module liste de documents numériques
Création d'un module de liste de documents numériques regroupables/hiérarchisables selon des facettes de notices

#10956 : Module bannette
Création d'un module d'affichage de bannette pour le portail

#11124 : Module liste de veilles / construction du lien vers une veille
Module liste de veilles :
- Implémentation de la construction du lien vers une veille


*******************
EVOLUTIONS

--------------
Administration
--------------

#10224 : Affichage champ personnalisé basé sur les catégories
Ajout d'une option au champ personnalisé permettant de tout afficher ou juste la dernière feuille de l'arbre.

#10620 : Planificateur PMB : Substitution du catalog.xml 
Substitution possible pour les types de tâches personnalisés

#10857 : Calcul des droits d'accès
La case à cocher 'Garder les droits spécifiques' est cochée par défaut.

---------
Catalogue
---------

#11113 : Choix de la valeur par défaut du champ 'nouveauté' dans les préférences utilisateurs
La valeur par défaut du champ 'nouveauté' en création de notice est paramétrable par utilisateur.

#11223 : Recherche multi-critères
Possibilité de sélectionner plusieurs autorités sur un même critère, avec choix de l'opérateur et/ou entre ces opérateurs.

-----------
Circulation
-----------

#10845 : Liste de circulation
Les champs suivants sont désormais ajoutables à la fiche de circulation : catégorie, statut, code statistique, groupe.

--------
Demandes
--------

#10298 : Champs personnalisés Demandes
Ajout de champs personnalisés sur le module Demandes

--------
Editions
--------

#10227 : Import/export de templates de notices
L'import/export des templates de notices est désormais possible.

#11477 : Evolution de la fonction #ellipse(); dans les templates de notices
Possibilité de tronquer sur le nombre de caractères ou sur le nombre de mots.

----
OPAC
----

#10168 : Corrections pour l'affichage Django des notices
Repli sur les templates du dossier common dans le cas des templates absents du dossier personnalisé.
Correction du problème d'affichage du bouton d'ajout au panier quand on n'en a pas le droit.

#10476 : Mécanique pour changer les images
Nouvelle fonction dans misc.inc.php : get_url_icon(nom_icone);

Cette fonction cherche l'icône dans cet ordre :
- Répertoire images du style client
- Répertoire images du style common
- Sinon Répertoire images de l'OPAC

Mis en place pour les icônes de panier et pour la 'no_image' dans un carrousel du portail.

#10561 : Création de messages pour le BBcode dans les avis
Les libellés des boutons sont dans les fichiers de messages, donc substituables.

#10935 : Suggestions : quantité et suggestions identiques
Il est possible de saisir la quantité dans les suggestions. Les suggestions identiques sont autorisées si l'utilisateur est complètement anonyme : emprunteur non authentifié et adresse email non saisie.

#11000 : Affichage django des notices / évolution du template common
Ajout des catégories et des champs personnalisés

#11080 : Historique : tout cocher/tout décocher et ordre des boutons
Le bouton 'cocher toutes les cases' devient 'cocher/tout décocher' et est placé avant le bouton 'supprimer les recherches cochées'.

#11427 : Amélioration de requêtes pour l'affichage des périodiques à l'OPAC 
Modification de requêtes dans la classe d'affichage pour l'affichage des notices de périodique à l'OPAC 

#9848 : Compte lecteur : export excel des prêts
Ajout d'un bouton qui permet d'exporter les prêts en cours ou en retard au format excel avec mise en forme

-------
Portail
-------

#10426 : Module liste de bannettes / ajout de méthodes pour la source de données
Ajout des sources de données :
- depuis un champ de type de contenu d'une rubrique
- depuis un champ de type de contenu d'un article
- sélecteur par la valeur d'un champ générique d'article
- sélecteur par la valeur d'un champ générique de rubrique

#10800 : Span de construction portail
Ajout d'une classe 'cmsNoStyle' sur les <span> représentant les cadres hors de la page courante du portail, en mode construction. 

#11090 : Vider le cache
Création d'un bouton pour vider le cache : celui-ci apparait en gestion du contenu éditorial, si un article ou une section est plus récent que le cache des cadres du portail.

#11126 : Module liste d'items / utilisation des tags
- Corrections pour l'affichage des tags pour la vue Django
- Permettre de sélectionner une page pour la construction du lien vers le tag
- Permettre de sélectionner une page pour la construction du lien vers l'item

#11220 : Module liste d'items / Vue Django par Tags
Nouvelle vue Django de liste d'items classés par Tags
